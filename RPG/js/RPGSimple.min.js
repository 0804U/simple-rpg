function saveState(a){window.localStorage.setItem("gameState",JSON.stringify(a))}function restoreState(){var a=window.localStorage.getItem("gameState");return a?JSON.parse(a):null}function saveState(a){window.localStorage.setItem("gameState",JSON.stringify(a))}function restoreState(){var a=window.localStorage.getItem("gameState");return a?JSON.parse(a):null}ActionButtons=function(a,b,c){Phaser.Group.call(this,a,c),this.currentActive,this.walk={up:null,active:null},this.setButton(0,0,"walkBtn0001.png","walkBtn0002.png",this.walk,this.dowalk),this.use={up:null,active:null},this.setButton(71,0,"useBtn0001.png","useBtn0002.png",this.use,this.douse),this.look={up:null,active:null},this.setButton(142,0,"lookBtn0001.png","lookBtn0002.png",this.look,this.dolook),this.talk={up:null,active:null},this.setButton(212,0,"talkBtn0001.png","talkBtn0002.png",this.talk,this.dotalk),this.dowalk()},ActionButtons.prototype=Object.create(Phaser.Group.prototype),ActionButtons.constructor=ActionButtons,ActionButtons.prototype.setButton=function(a,b,c,d,e,f){e.up=this.game.make.sprite(a,b,"dialogui",c),this.add(e.up),e.up.inputEnabled=!0,e.up.events.onInputDown.add(f,this),e.active=this.game.make.sprite(a,b,"dialogui",d),e.active.visible=!1,this.add(e.active)},ActionButtons.prototype.dowalk=function(){this.disableButton(this.currentActive),GlobalEvents.currentacion=GlobalEvents.WALK,this.currentActive=this.walk,this.enableButton(this.currentActive)},ActionButtons.prototype.douse=function(){this.disableButton(this.currentActive),GlobalEvents.currentacion=GlobalEvents.TOUCH,this.currentActive=this.use,this.enableButton(this.currentActive)},ActionButtons.prototype.dolook=function(){this.disableButton(this.currentActive),GlobalEvents.currentacion=GlobalEvents.LOOK,this.currentActive=this.look,this.enableButton(this.currentActive)},ActionButtons.prototype.dotalk=function(){this.disableButton(this.currentActive),GlobalEvents.currentacion=GlobalEvents.TALK,this.currentActive=this.talk,this.enableButton(this.currentActive)},ActionButtons.prototype.enableButton=function(a){null!=a&&(a.up.visible=!1,a.active.visible=!0)},ActionButtons.prototype.disableButton=function(a){null!=a&&(a.up.visible=!0,a.active.visible=!1)},BasicObjectPool=function(a){this.openArray=[]||a,this.allObjectsArray=[]||a},BasicObjectPool.prototype.getObject=function(){return this.openArray.length>0?this.openArray.pop():newObject},BasicObjectPool.prototype.addObject=function(a){this.openArray.push(a),this.allObjectsArray.push(a)},BasicObjectPool.prototype.returnObject=function(a){a.reset(),this.openArray.push(a)},BasicObjectPool.prototype.destroyself=function(){this.allObjectsArray=[],this.openArray=[]};var DialogHandler=function(a,b,c){this.game=a,this.conversations=b,this.actors=c,this.currentConvo,this.playerActor=this.getPlayerActor()};DialogHandler.prototype.startConvo=function(a){if(this.currentConvo=this.getConversationsByID(a),null!=this.currentConvo){var b=this.buildDialogByID(0);if(null!=b)return""==b.current.MenuText&&""==b.current.DialogueText&&(b=this.buildDialogWithDiag(b.links[0])),b}return null},DialogHandler.prototype.getNextDialog=function(a){return a.links.length<=0||null==a.links[0]?null:this.buildDialogByID(a.links[0].DestID)},DialogHandler.prototype.buildDialogByID=function(a){var b=this.getDialogByID(a);return null==b?null:this.buildDialogWithDiag(b)},DialogHandler.prototype.buildDialogWithDiag=function(a){if(null==a)return null;for(var b,c=[],d=a.links.length,e=0;d>e;e++){var b=this.getDialogByID(a.links[e].DestID);null!=b&&c.push(b)}var f=this.getActorByID(a.Actor),g={current:a,links:c,actor:f};return g},DialogHandler.prototype.getDialogByID=function(a){for(var b=this.currentConvo.DialogueEntries.length,c=0;b>c;c++)if(this.currentConvo.DialogueEntries[c].ID==a)return this.currentConvo.DialogueEntries[c];return null},DialogHandler.prototype.getConversationsByID=function(a){for(var b=this.conversations.length,c=0;b>c;c++)if(this.conversations[c].id==a)return this.conversations[c];return null},DialogHandler.prototype.getActorByID=function(a){for(var b=this.actors.length,c=0;b>c;c++)if(this.actors[c].id==a)return this.actors[c];return null},DialogHandler.prototype.getPlayerActor=function(){for(var a=this.actors.length,b=0;a>b;b++)if(this.actors[b].IsPlayer)return this.actors[b];return null};var EventDispatcher=function(a,b,c){this.game=a,this.maingame=b,this.object=c,GlobalEvents.allEventDispatchers.push(this)};EventDispatcher.prototype.receiveData=function(a){this.onTouchAction,this.onLookAction,this.onTalkAction,this.onEnterAction,this.onStartAction,this.init(a)},EventDispatcher.prototype.testAction=function(){this.object&&(this.object.inputEnabled=this.shouldBeActive())},EventDispatcher.prototype.shouldBeActive=function(){return GlobalEvents.currentacion==GlobalEvents.WALK?!1:GlobalEvents.currentacion==GlobalEvents.TOUCH&&this.onTouchAction?!0:GlobalEvents.currentacion==GlobalEvents.LOOK&&this.onLookAction?!0:GlobalEvents.currentacion==GlobalEvents.TALK&&this.onTalkAction?!0:!1},EventDispatcher.prototype.init=function(a){for(var b,c,d,e,f,g=0;g<a.length;g++)if(b=a[g],d=b.trigger,f=null,b.conditions&&b.conditions.conditions&&(f=this.applyConditions(b.conditions)),b.actions)for(var h=0;h<b.actions.length;h++)c=b.actions[h],e=this.getEventType(d),"ChangeMap"==c.type?e.push({func:this.maingame.userExit,para:[c],removeself:b.once,callee:this.maingame,con:f}):"CONVERSATION"==c.type?e.push({func:this.maingame.showDialog,para:[c.id],removeself:b.once,callee:this.maingame,con:f}):"SIMPLE"==c.type?e.push({func:this.maingame.showJustTextDialog,para:[c.id],removeself:b.once,callee:this.maingame,con:f}):"BARK"==c.type||("THIS"==c.type?e.push({func:this.object.callFunction,para:[c["function"],c.parameters],removeself:!1,callee:this.object,con:f}):"Item"==c.type?e.push({func:this.maingame.globalHandler.updateItem,para:[c.name,c.mode,c.variable,c.value],removeself:!1,callee:this.maingame.globalHandler,con:f}):"Actor"==c.type?e.push({func:this.maingame.globalHandler.updateActor,para:[c.name,c.mode,c.variable,c.value],removeself:!1,callee:this.maingame.globalHandler,con:f}):"Variable"==c.type?e.push({func:this.maingame.globalHandler.updateVariableByID,para:[c.name,c.mode,c.value],removeself:!1,callee:this.maingame.globalHandler,con:f}):"Quest"==c.type);else if("actiontext"==b.type){var f=null;if(b.conditions)var f=this.applyConditions(b.conditions);b.lookatactive&&this.getEventType("OnLook").push({func:this.maingame.showJustText,para:b.lookat,removeself:!1,callee:this.maingame,con:f})}},EventDispatcher.prototype.applyConditions=function(a){for(var b=a.conditions,c=a.logic,d=[],e=0;e<b.length;e++)condition=b[e],"Item"==condition.type?d.push({func:this.maingame.globalHandler.compareItemValue,para:[condition.name,condition.variable,condition.compare,condition.value],callee:this.maingame.globalHandler}):"Actor"==condition.type?d.push({func:this.maingame.globalHandler.compareActorValue,para:[condition.name,condition.variable,condition.compare,condition.value],callee:this.maingame.globalHandler}):"Variable"==condition.type?d.push({func:this.maingame.globalHandler.compareVariableValue,para:[condition.name,condition.compare,condition.value],callee:this.maingame.globalHandler}):"Quest"==condition.type?d.push({func:this.maingame.globalHandler.compareQuestValue,para:[condition.name,condition.compare,condition.value],callee:this.maingame.globalHandler}):console("Apply conditions unknown",action.type,action);var f={logic:c,list:d};return f},EventDispatcher.prototype.testConditions=function(a){if(!a.list)return!0;if(a.list.length<=0)return!0;for(var b,c=a.list,d=a.logic,e=!1,f=0;f<c.length;f++)if(b=c[f].func.apply(c[f].callee,c[f].para),console.log(b,d,c[f]),"All"==d){if(0==b)return!1;e=!0}else if(1==b)return!0;return e},EventDispatcher.prototype.doAction=function(a){var b=this.getEventType(a);if(b.length>0)for(var c=0;c<b.length;c++)if(b[c]){if(b[c].con&&!this.testConditions(b[c].con))continue;b[c].func.apply(b[c].callee,b[c].para),b[c].removeself&&(b[c]=null,console.log("remove event"))}},EventDispatcher.prototype.getEventType=function(a){return"OnEnter"==a?(this.onEnterAction=this.onEnterAction||[],this.onEnterAction):"OnStart"==a?(this.onStartAction=this.onStartAction||[],this.onStartAction):"OnTouch"==a?(this.onTouchAction=this.onTouchAction||[],this.onTouchAction):"OnTalk"==a?(this.onTalkAction=this.onTalkAction||[],this.onTalkAction):"OnLook"==a?(this.onLookAction=this.onLookAction||[],this.onLookAction):void 0},EventDispatcher.prototype.destroy=function(){this.onTouchAction=null,this.onLookAction=null,this.onTalkAction=null,this.onEnterAction=null,this.onStartAction=null};var EventConv=function(){};EventConv.prototype.removeSelf=function(){},EventConv.prototype.activateEvent=function(){this.maingame.showDialog(this.convid),this.once};var EventnText=function(){},GlobalHandler=function(a,b,c,d,e,f){this.game=a,this.maingame=b,this.actors=[];for(var g=0;g<c.length;g++)this.actors[c[g].id.toString()]=new ActorObject(c[g]);this.variables=[];for(var g=0;g<d.length;g++)this.variables[d[g].id.toString()]=new VariableObject(d[g]);this.items=[],this.quests=[];for(var g=0;g<f.length;g++)f[g]["Is Item"]?this.items[f[g].id.toString()]=new ItemObject(f[g]):this.quests[f[g].id.toString()]=new QuestObject(f[g])};GlobalHandler.prototype.compareQuestValue=function(a,b,c){return this.quests[a]?this.doCompare(b,this.quests[a].State,c):!1},GlobalHandler.prototype.updateQuestByID=function(a,b,c){return this.quests[a]?("Add"==b?this.quests[a].value+=parseFloat(c):this.quests[a].value=c,!0):!1},GlobalHandler.prototype.compareVariableValue=function(a,b,c){return this.variables[a]?this.doCompare(b,this.variables[a].value,c):!1},GlobalHandler.prototype.getVariableValue=function(a){return this.variables[a]?this.variables[a].value:null},GlobalHandler.prototype.updateVariableByID=function(a,b,c){return this.variables[a]?("Add"==b?this.variables[a].value+=parseFloat(c):this.variables[a].value=c,!0):!1},GlobalHandler.prototype.doCompare=function(a,b,c){return"Is"==a?b==c:"IsNot"==a?b!=c:"Less"==a?c>b:"Greater"==a?b>c:"LessEqual"==a?c>=b:"GreaterEqual"==a?b>=c:void 0},GlobalHandler.prototype.compareItemValue=function(a,b,c,d){return this.items[a]?null==this.items[a].json[b]?!1:this.doCompare(c,this.items[a].json[b],d):!1},GlobalHandler.prototype.getItemValue=function(a,b){return this.items[a]?this.items[a][b]:null},GlobalHandler.prototype.getItemByID=function(a){return this.items[a]?this.items[a]:null},GlobalHandler.prototype.updateItem=function(a,b,c,d){var e=this.getItemByID(a);e?"Add"==b?e.addValue(c,d):e.updateValue(c,d):console.log(a,"not found")},GlobalHandler.prototype.compareActorValue=function(a,b,c,d){return this.actors[a]&&this.actors[a][b]?this.doCompare(c,this.actors[a][b],d):!1},GlobalHandler.prototype.getActorValue=function(a,b){return this.actors[a]?this.actors[a][b]:null},GlobalHandler.prototype.getActorByID=function(a){return this.actors[a]?this.actors[a]:null},GlobalHandler.prototype.updateActor=function(a,b,c,d){var e=this.getActorByID(a);e?"Add"==b?e.addValue(c,d):e.updateValue(c,d):console.log(a,"not found")},GlobalHandler.prototype.setActor=function(a,b){this.actors[a]&&this.actors[i].bind.push(b)};var BaseObject=function(a){this.OnChangeSignal=new Phaser.Signal,this.json=a};BaseObject.prototype.updateValue=function(a,b){this.json[a]=b,this.OnChangeSignal.dispatch([this])},BaseObject.prototype.addValue=function(a,b){null!=this.json[a]&&(this.json[a]+=b),this.OnChangeSignal.dispatch([this])};var ItemObject=function(a){BaseObject.call(this,a)};ItemObject.prototype=Object.create(BaseObject.prototype),ItemObject.constructor=ItemObject;var ActorObject=function(a){BaseObject.call(this,a),this.bind=[]};ActorObject.prototype=Object.create(BaseObject.prototype),ActorObject.constructor=ActorObject;var QuestObject=function(a){BaseObject.call(this,a)};QuestObject.prototype=Object.create(BaseObject.prototype),QuestObject.constructor=QuestObject,Object.defineProperty(QuestObject,"value",{get:function(){return this._value},set:function(a){this._value=a,this.OnChangeSignal.dispatch([this])}});var VariableObject=function(a){BaseObject.call(this,a),this.id=a.id,this.name=a.Name,this._value=a["Initial Value"],this.description=a.Description};VariableObject.prototype=Object.create(BaseObject.prototype),VariableObject.constructor=VariableObject,Object.defineProperty(VariableObject,"value",{get:function(){return this._value},set:function(a){this._value=a,this.OnChangeSignal.dispatch([this])}});var GlobalEvents=function(){};GlobalEvents.allEventDispatchers=[],GlobalEvents.WALK=0,GlobalEvents.LOOK=1,GlobalEvents.TOUCH=2,GlobalEvents.TALK=3,GlobalEvents._currentacion=GlobalEvents.WALK,Object.defineProperty(GlobalEvents,"currentacion",{get:function(){return GlobalEvents._currentacion},set:function(a){GlobalEvents._currentacion=a,GlobalEvents.refreshEvents()}}),GlobalEvents.flushEvents=function(){GlobalEvents.allEventDispatchers=[]},GlobalEvents.refreshEvents=function(){for(var a=GlobalEvents.allEventDispatchers,b=0;b<a.length;b++)a[b].testAction()};var HexHandler=function(a,b,c,d){this.maingame=a,this.game=b,this.debug=!0,this.visited=[],this.fringes=[],this.hexagonArray=[],this.waterTilesArray=[],this.hexagonWidth=c||63,this.hexagonHeight=d||65,this.sectorWidth=this.hexagonWidth,this.sectorHeight=this.hexagonHeight/4*3,this.halfHex=this.hexagonWidth/2,this.gradient=this.hexagonHeight/4/(this.hexagonWidth/2)};HexHandler.prototype.update=function(a){if(this.waterTilesArray)for(var b=this.waterTilesArray.length,c=0;b>c;c++)this.waterTilesArray[c].step(a)},HexHandler.prototype.checkHex=function(a,b){if(this.hexagonArray){var c=a%this.sectorWidth,d=b%this.sectorHeight,e=Math.floor(a/this.sectorWidth),f=Math.floor(b/this.sectorHeight);if(f%2==0?(d<this.hexagonHeight/4-c*this.gradient&&(e--,f--),d<-this.hexagonHeight/4+c*this.gradient&&f--):c>=this.hexagonWidth/2?d<this.hexagonHeight/2-c*this.gradient&&f--:d<c*this.gradient?f--:e--,this.maingame.gridSizeY%2==0&&f%2==1&&(e++,0>e&&(e=0)),!(0>e||0>f||f>=this.maingame.gridSizeY))return this.hexagonArray[f][e]}},HexHandler.prototype.getTileByCords=function(a,b){return this.hexagonArray[a]&&this.hexagonArray[a][b]?this.hexagonArray[a][b]:null},HexHandler.prototype.lineTest=function(a,b){var c=new Point(a.x+this.halfHex,a.y+this.halfHex),d=new Point(b.x+this.halfHex,b.y+this.halfHex),e=this.game.math.distance(c.x,c.y,d.x,d.y);e=this.game.math.ceil(e/this.hexagonWidth)+1;for(var f=[],g=0;e>=g;g++){var h=0==e?0:g/e;f.push(this.lerp_point(c,d,h))}for(var i=0;i<f.length;i++){var j=this.checkHex(f[i].x,f[i].y);if(null==j)return null;if(!j.walkable)return j}return b},HexHandler.prototype.dolines=function(a,b,c){var d=new Point(a.x+this.halfHex,a.y+this.halfHex),e=new Point(b.x+this.halfHex,b.y+this.halfHex);this.debug&&(this.maingame.graphics.clear(),this.maingame.graphics.lineStyle(10,16767232,1),this.maingame.graphics.moveTo(a.x+hexagonGroup.x+this.halfHex,a.y+hexagonGroup.y+this.halfHex),this.maingame.graphics.lineTo(b.x+hexagonGroup.x+this.halfHex,b.y+hexagonGroup.y+this.halfHex));var f=this.game.math.distance(d.x,d.y,e.x,e.y);f=this.game.math.ceil(f/this.hexagonWidth)+1;for(var g=[],h=0;f>=h;h++){var i=0==f?0:h/f;g.push(this.lerp_point(d,e,i))}var j=[];this.debug&&(this.maingame.graphics.lineStyle(0),this.maingame.graphics.beginFill(65291,.5));for(var k=0;k<g.length;k++){var l=this.maingame.checkHex(g[k].x,g[k].y);if(this.debug&&this.maingame.graphics.drawCircle(g[k].x+hexagonGroup.x,g[k].y+hexagonGroup.y,10),null!=l){if(!l.walkable&&!c)break;j.push(l),this.debug&&this.maingame.highlightpath(k,l)}}if(this.debug&&this.maingame.graphics.endFill(),this.debug)for(k=j.length;k<this.maingame.neighborLights.length;k++)this.maingame.highlightpath(k,null);return j},HexHandler.prototype.round_point=function(a){return new Point(Math.round(a.x),Math.round(a.y))},HexHandler.prototype.lerp=function(a,b,c){return a+c*(b-a)},HexHandler.prototype.lerp_point=function(a,b,c){return new Point(this.lerp(a.x,b.x,c),this.lerp(a.y,b.y,c))},HexHandler.prototype.doFloodFill=function(a,b){this.visited=[],this.visited.push(a),this.fringes=[],this.fringes.push([a]);for(var c=1;b>=c;c++){this.fringes.push([]);for(var d=0;d<this.fringes[c-1].length;d++){var e=this.fringes[c-1][d];e.posx%2==1?(this.addNeighbor(e,0,-1,c),this.addNeighbor(e,-1,0,c),this.addNeighbor(e,0,1,c),this.addNeighbor(e,1,1,c),this.addNeighbor(e,1,0,c),this.addNeighbor(e,-1,1,c)):(this.addNeighbor(e,-1,-1,c),this.addNeighbor(e,-1,0,c),this.addNeighbor(e,0,1,c),this.addNeighbor(e,1,0,c),this.addNeighbor(e,0,-1,c),this.addNeighbor(e,1,-1,c))}}return this.fringes},HexHandler.prototype.addNeighbor=function(a,b,c,d){b=a.posx+b,c=a.posy+c;var e=this.maingame.getTileByCords(b,c);null!=e&&e.walkable&&-1==this.visited.indexOf(e)&&(this.visited.push(e),this.fringes[d].push(e))},HexHandler.prototype.getFrigesAsArray=function(){for(var a=[],b=0;b<fridges.length;b++)for(var c=0;c<fridges[b].length;c++)a.push(fridges[b][c]);return a},HexHandler.prototype.areTilesNeighbors=function(a,b){var c=a.posx-b.posx,d=a.posy-b.posy;if(a.posx%2==1){if(0==c&&-1==d)return!0;if(-1==c&&0==d)return!0;if(0==c&&1==d)return!0;if(1==c&&1==d)return!0;if(1==c&&0==d)return!0;if(-1==c&&1==d)return!0}else{if(-1==c&&-1==d)return!0;if(-1==c&&0==d)return!0;if(0==c&&1==d)return!0;if(1==c&&0==d)return!0;if(0==c&&-1==d)return!0;if(1==c&&-1==d)return!0}return!1},HexHandler.prototype.flush=function(){this.hexagonArray=[],this.waterTilesArray=[],this.walkableArray=[]};var InteractiveObject=function(a,b){this.maingame=a,this.game=a.game,this.jsondata=b,this.eventDispatcher=new EventDispatcher(this.game,this.maingame,this),this.eventDispatcher.init(this.jsondata.triggers),this.setupArt(this.jsondata),this.events.onInputDown.add(this.handleClick,this),this.inputEnabled=!0};InteractiveObject.prototype=Object.create(Phaser.Sprite.prototype),InteractiveObject.constructor=MovingCharacter,InteractiveObject.prototype.callFunction=function(a,b){var c=this[a];b=b.split(","),"function"==typeof c&&c.apply(this,b)},InteractiveObject.prototype.destroySelf=function(){this.jsondata.destroyed=!0,this.eventDispatcher.destroy(),this.events.onInputDown.remove(this.handleClick,this),this.destroy()},InteractiveObject.prototype.step=function(){},InteractiveObject.prototype.setupReactToAction=function(){this.events.onInputDown.add(handleClick,this)},InteractiveObject.prototype.handleClick=function(){GlobalEvents.currentacion!=GlobalEvents.WALK&&(GlobalEvents.currentacion==GlobalEvents.TOUCH?this.eventDispatcher.doAction("OnTouch"):GlobalEvents.currentacion==GlobalEvents.LOOK?this.eventDispatcher.doAction("OnLook"):GlobalEvents.currentacion==GlobalEvents.TALK&&this.eventDispatcher.doAction("OnTalk"))},InteractiveObject.prototype.setupArt=function(){var a=this.maingame.getTile(this.jsondata.name,this.jsondata.tilesetid),b=this.jsondata.x,c=this.maingame.gridSizeY-this.jsondata.y-1;Phaser.Sprite.call(this,this.game,this.jsondata.offsetx*this.maingame.hexHandler.hexagonWidth,this.jsondata.offsety*this.maingame.hexHandler.hexagonHeight,a.spritesheet,a.tile+".png"),this.maingame.hexHandler.hexagonArray[c][b].addChild(this),this.anchor.x=.5,this.anchor.y=1};var InventoryEngine=function(){};InventoryEngine.prototype.enterInventory=function(){};var MovingCharacter=function(a,b,c){Phaser.Sprite.call(this,b,0,0,"actors","movingPerson2_idle0001.png"),this.game=b,this.maingame=a,this.name=c,this.IsPlayer=!0,this.anchor.x=.5,this.anchor.y=1,this.animations.add("idle",Phaser.Animation.generateFrameNames("movingPerson2_idle",1,2,".png",4),1,!0,!1),this.animations.add("walk",Phaser.Animation.generateFrameNames("movingPerson2_walk",1,4,".png",4),8,!0,!1),this.animations.play("idle"),this.oldTile,this.currentTile,this.path=null,this.pathlocation=0,this.nextTile,this.dir=new Phaser.Point,this.walkspeed=.1875};MovingCharacter.prototype=Object.create(Phaser.Sprite.prototype),MovingCharacter.constructor=MovingCharacter,MovingCharacter.prototype.isMoving=function(){return 0==this.dir.x&&0==this.dir.y?!1:!0},MovingCharacter.prototype.callFunction=function(a,b){var c=window[a];"function"==typeof c&&c.apply(null,b)},MovingCharacter.prototype.setLocation=function(a,b){this.x=a,this.y=b},MovingCharacter.prototype.setLocationByTile=function(a){this.x=a.x+this.maingame.hexHandler.halfHex,this.y=a.y+this.maingame.hexHandler.halfHex,this.oldTile=a,this.currentTile=a},MovingCharacter.prototype.setDirection=function(){this.dir.x=this.nextTile.x+this.maingame.hexHandler.halfHex-this.x,this.dir.y=this.nextTile.y+this.maingame.hexHandler.halfHex-this.y,this.dir.normalize()},MovingCharacter.prototype.setPath=function(a){a&&(a.length<=0||(this.path=a,this.pathlocation=0,this.nextTile=this.maingame.hexHandler.getTileByCords(a[this.pathlocation].x,a[this.pathlocation].y),this.setDirection(),this.animations.play("walk")))},MovingCharacter.prototype.step=function(a){if(null!=this.path&&this.path.length>0&&(this.currentTile=this.maingame.hexHandler.checkHex(this.x,this.y),this.currentTile.posx==this.nextTile.posx&&this.currentTile.posy==this.nextTile.posy))if(this.pathlocation++,this.pathlocation>=this.path.length){this.pathlocation=this.path.length;var b=this.currentTile.x+this.maingame.hexHandler.halfHex,c=this.currentTile.y+this.maingame.hexHandler.halfHex,d=3;b-d<this.x&&b+d>this.x&&c-d<this.y&&c+d>this.y&&(this.x=b,this.y=c,this.path=null,this.dir.x=0,this.dir.y=0,this.currentTile.enterTile(),this.animations.play("idle")),this.setDirection()}else this.nextTile=this.maingame.hexHandler.getTileByCords(this.path[this.pathlocation].x,this.path[this.pathlocation].y),this.setDirection();this.x+=this.dir.x*this.walkspeed*a,this.y+=this.dir.y*this.walkspeed*a,this.dir.x<0?this.scale.x=-1:this.dir.x>0&&(this.scale.x=1)};var BasicGame={};BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.game.device.desktop?this.scale.pageAlignHorizontally=!0:(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.setMinMax(480,260,1024,768),this.scale.forceLandscape=!0,this.scale.pageAlignHorizontally=!0)},preload:function(){this.load.atlasJSONHash("loadingScreen","assets/loading.png","assets/loading.json")},create:function(){this.state.start("Preloader")}},BasicGame.Instructions=function(){this.music=null,this.playButton=null},BasicGame.Instructions.prototype={create:function(){this.add.sprite(0,0,"instructions"),this.playButton=this.add.button(177,529,"ui",this.returnToMain,this,"OK Button0001.png","OK Button0002.png","OK Button0002.png","OK Button0001.png")},update:function(){},returnToMain:function(){this.state.start("MainMenu")}},BasicGame.Game=function(){this.playerCharacter,this.playerHex,this.diagpanel,this.justTextPopup,this.activeButtons,this.neighborLights=[],this.gridSizeX=30,this.gridSizeY=15,this.hexHandler,this.pathfinder,this.graphics,this.uiGroup,this.hexagonGroup,this.characterGroup,this.interactiveObjects=[],this.startpos,this.mapData,this.globalHandler},BasicGame.Game.prototype={preload:function(){this.load.json("map","assets/desertIsland.json")},create:function(){this.stage.backgroundColor="#666666",this.pathfinder=this.game.plugins.add(Phaser.Plugin.PathFinderPlugin),this.interactiveObjects=[],this.uiGroup=this.add.group(),this.mapData=this.game.cache.getJSON("map"),this.hexHandler=new HexHandler(this,this.game,this.mapData.mapData.hexWidth,this.mapData.mapData.hexHeight),this.globalHandler=new GlobalHandler(this.game,this,this.mapData.data.Actors,this.mapData.data.Variables,null,this.mapData.data.Items),this.startpos=this.mapData.startPos.split("_");var a=this.mapData.maps[this.startpos[0]];this.createMapTiles(a),this.dialoghandler=new DialogHandler(this,this.mapData.data.Conversations,this.mapData.data.Actors),this.diagpanel=new DialogPanel(this.game,this,this.dialoghandler),this.game.add.existing(this.diagpanel),this.uiGroup.add(this.diagpanel),this.justTextPopup=new JustTextPopup(this.game,this,this.dialoghandler),this.game.add.existing(this.justTextPopup),this.uiGroup.add(this.justTextPopup),this.input.onDown.add(this.clickedHex,this),this.activeButtons=new ActionButtons(this.game,this),this.activeButtons.y=350,this.game.add.existing(this.activeButtons),this.uiGroup.add(this.activeButtons),this.graphics=this.game.add.graphics(0,0),this.uiGroup.add(this.graphics)},createMapTiles:function(a){var b=[],c=[],d=this.hexHandler.hexagonWidth,e=this.hexHandler.hexagonHeight;this.hexagonGroup=this.add.group(),this.characterGroup=this.add.group(),this.uiGroup.parent.bringToTop(this.uiGroup);var f=a[0];this.gridSizeY=f.height,this.gridSizeX=f.width;for(var g,h,i,j=f.data,k=f.tilesetid,l=[],m=0;m<this.gridSizeY;m++){b[m]=[],l[m]=[];for(var n=0;n<this.gridSizeX;n++){g=j[m*this.gridSizeX+n],h=this.getTile(g,k);var o=d*n;this.gridSizeY%2?o+=d/2*(m%2):o-=d/2*(m%2);var p=e/4*3*m;"tileWater"==h.tile?(i=new WaterTile(this,h.tile+".png",h.spritesheet,m,n,o,p),c.push(i)):i=new WalkableTile(this,h.tile+".png",h.spritesheet,m,n,o,p,this),b[m][n]=i,this.hexagonGroup.add(i),l[m][n]=f.walkable[m*this.gridSizeX+n],0==l[m][n]&&(b[m][n].walkable=!1)}}this.pathfinder.setGrid(l,[1]),this.hexHandler.hexagonArray=b,this.hexHandler.waterTilesArray=c;for(var q,r,s=f.objects,m=0;m<s.length;m++)if(s[m].triggers){if(!s[m].destroyed){var t=new InteractiveObject(this,s[m],v);this.interactiveObjects.push(t)}}else{var u=this.getTile(s[m].name,s[m].tilesetid);q=s[m].x,r=this.gridSizeY-s[m].y-1;var v=this.game.make.sprite(s[m].offsetx*d,s[m].offsety*e,u.spritesheet,u.tile+".png");b[r][q].addChild(v),v.anchor.x=.5,v.anchor.y=1}for(var w=f.actionSpots,m=0;m<w.length;m++){var x=b[this.gridSizeY-w[m].y-1][w[m].x];x&&(x.eventDispatcher||(x.eventDispatcher=new EventDispatcher(this.game,this,x)),x.eventDispatcher.receiveData(w[m].triggers))}this.hexagonGroup.y=(300-e*Math.ceil(this.gridSizeY/2))/2,this.gridSizeY%2==0&&(this.hexagonGroup.y-=e/4),this.hexagonGroup.x=(900-Math.ceil(this.gridSizeX)*d)/2,this.gridSizeX%2==0&&(this.hexagonGroup.x-=d/8),this.hexagonGroup.sort("y",Phaser.Group.SORT_ASCENDING),this.playerCharacter||(this.playerCharacter=new MovingCharacter(this,this.game,"player"),this.game.add.existing(this.playerCharacter),this.playerCharacter.setLocationByTile(b[this.gridSizeY-this.startpos[2]-1][this.startpos[1]])),this.hexagonGroup.add(this.playerCharacter)},setChangeMapTile:function(a){var b=this.game.make.sprite(0,0,"tiles","mapexit.png");a.addChild(b)},userExit:function(a){this.startpos[0]=a.tmap,this.startpos[1]=a.tx,this.startpos[2]=a.ty,this.flushEntireMap();var b=this.mapData.maps[this.startpos[0]];GlobalEvents.flushEvents(),this.createMapTiles(b)},flushEntireMap:function(){this.hexagonGroup.destroy(),this.characterGroup.destroy(),this.playerCharacter=null,this.hexHandler.flush()},update:function(){var a=this.game.time.elapsed;this.hexHandler.update(a),this.game.global.pause||(this.playerCharacter.step(a),this.playerHex=this.hexHandler.checkHex(this.playerCharacter.x,this.playerCharacter.y)),this.hexagonGroup.sort("y",Phaser.Group.SORT_ASCENDING)},showDialog:function(a){this.diagpanel.startDialog(a),this.pauseGame()},showJustText:function(a){this.justTextPopup.showText(a),this.pauseGame()},showJustTextDialog:function(a){this.justTextPopup.showTextFromHandler(a),this.pauseGame()},pauseGame:function(){this.game.global.pause||(this.game.global.pause=!0)},unpauseGame:function(){this.game.global.pause&&(this.game.global.pause=!1)},quitGame:function(){this.state.start("MainMenu")},clickedHex:function(){if(GlobalEvents.currentacion==GlobalEvents.WALK&&!this.game.global.pause){var a=this.hexHandler.checkHex(this.input.worldX-this.hexagonGroup.x,this.input.worldY-this.hexagonGroup.y);if(null!=a&&this.game.currentacion==this.game.WALK&&a.walkable){var b=this.hexHandler.checkHex(this.playerCharacter.x,this.playerCharacter.y);b&&(this.pathfinder.setCallbackFunction(this.playercallback,this),this.pathfinder.preparePathCalculation([b.posx,b.posy],[a.posx,a.posy]),this.pathfinder.calculatePath())}}},playercallback:function(a){a=a||[],this.playerCharacter.setPath(a)},getTile:function(a,b){return{tile:this.mapData.tileSets[b][a],spritesheet:this.mapData.tileSets[b].tileset}}};var Point=function(a,b){this.x=a,this.y=b};BasicGame.MainMenu=function(){this.music=null,this.playButton=null},BasicGame.MainMenu.prototype={create:function(){this.add.sprite(0,0,"mainmenu"),this.playButton=this.add.button(376,425,"ui",this.startGame,this,"Play Button0001.png","Play Button0002.png","Play Button0002.png","Play Button0001.png"),this.playButton=this.add.button(376,487,"ui",this.gotoInstructions,this,"Instructions Button0001.png","Instructions Button0002.png","Instructions Button0002.png","Instructions Button0001.png")},update:function(){},startGame:function(){this.state.start("Game")},gotoInstructions:function(){this.state.start("Instructions")}},BasicGame.Preloader=function(){this.background=null,this.preloadBar=null,this.ready=!1},BasicGame.Preloader.prototype={preload:function(){this.background=this.add.sprite(0,0,"loadingScreen","bg.png"),this.preloadBar=this.add.sprite(0,278,"loadingScreen","loading_barfront.png"),this.load.atlasJSONHash("ui","assets/simpleui.png","assets/simpleui.json"),this.load.atlasJSONHash("tiles","assets/tiles.png","assets/tiles.json"),this.load.atlasJSONHash("actors","assets/actors.png","assets/actors.json"),this.load.atlasJSONHash("dialogui","assets/dialogui.png","assets/dialogui.json"),this.load.image("loading","assets/loading.png"),this.load.image("mainmenu","assets/mainmenu.png"),this.load.image("mapselect","assets/mapselect.png"),this.load.image("winscreen","assets/winscreen.png"),this.load.image("instructions","assets/instructions.png"),this.load.bitmapFont("badabb","assets/fonts/badabb.png","assets/fonts/badabb.fnt")},create:function(){this.preloadBar.cropEnabled=!1,this.state.start("Game")}};var BasicGame={};BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.game.device.desktop?this.scale.pageAlignHorizontally=!0:(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.setMinMax(480,260,1024,768),this.scale.forceLandscape=!0,this.scale.pageAlignHorizontally=!0)},preload:function(){this.load.atlasJSONHash("loadingScreen","assets/loading.png","assets/loading.json")},create:function(){this.state.start("Preloader")}},BasicGame.Instructions=function(){this.music=null,this.playButton=null},BasicGame.Instructions.prototype={create:function(){this.add.sprite(0,0,"instructions"),this.playButton=this.add.button(177,529,"ui",this.returnToMain,this,"OK Button0001.png","OK Button0002.png","OK Button0002.png","OK Button0001.png")},update:function(){},returnToMain:function(){this.state.start("MainMenu")}},BasicGame.GameWave=function(){this.game,this.add,this.camera,this.cache,this.input,this.load,this.math,this.sound,this.stage,this.time,this.tweens,this.state,this.world,this.particles,this.physics,this.rnd,this.playerCharacter,this.playerHex,this.halfHex=hexagonWidth/2,this.diagpanel,this.activeButtons,this.neighborLights=[],this.hexagonWidth=63,this.hexagonHeight=65,this.gridSizeX=30,this.gridSizeY=15,this.hexagonArray=[],this.hexHandler,this.graphics,this.justTextPopup};var hexagonWidth=63,hexagonHeight=65,columns=[Math.ceil(this.gridSizeX/2),Math.floor(this.gridSizeX/2)],moveIndex,sectorWidth=hexagonWidth,sectorHeight=hexagonHeight/4*3,gradient=hexagonHeight/4/(hexagonWidth/2),uiGroup,hexagonGroup,characterGroup,waterTilesArray=[],interactiveObjects=[],tiles=["tileGrass.png","tileAutumn.png","tileDirt.png","tileMagic.png","tileRock.png","tileSand.png","tileSnow.png","tileStone.png"],target,replacement,startTile,waveHandler,map,startpos,mapData,pathfinder;BasicGame.GameWave.prototype={preload:function(){this.load.text("map","assets/desertIsland.json")},create:function(){this.stage.backgroundColor="#666666",pathfinder=this.game.plugins.add(Phaser.Plugin.PathFinderPlugin),this.hexagonArray=[],
waterTilesArray=[],interactiveObjects=[],this.uiGroup=this.add.group(),this.mapData=JSON.parse(this.game.cache.getText("map")),startpos=this.mapData.startPos.split("_");var a=this.mapData.maps[startpos[0]];this.createMapTiles(a),this.dialoghandler=new DialogHandler(this,this.mapData.data.Conversations,this.mapData.data.Actors),this.diagpanel=new DialogPanel(this.game,this,this.dialoghandler),this.game.add.existing(this.diagpanel),this.uiGroup.add(this.diagpanel),this.justTextPopup=new JustTextPopup(this.game,this,this.dialoghandler),this.game.add.existing(this.justTextPopup),this.uiGroup.add(this.justTextPopup),this.input.onDown.add(this.clickedHex,this),this.activeButtons=new ActionButtons(this.game,this),this.activeButtons.y=350,this.game.add.existing(this.activeButtons),this.uiGroup.add(this.activeButtons),waveHandler=new WaveHandler,this.hexHandler=new HexHandler(this,this.game),this.graphics=this.game.add.graphics(0,0),this.uiGroup.add(this.graphics),this.showJustTextDialog(3)},createMapTiles:function(a){this.hexagonArray=[],g=[],hexagonGroup=this.add.group(),characterGroup=this.add.group(),this.uiGroup.parent.bringToTop(this.uiGroup);var b=a[0];this.gridSizeY=b.height,this.gridSizeX=b.width;for(var c,d,e=b.data,f=b.tilesetid,g=[],h=0;h<this.gridSizeY;h++){this.hexagonArray[h]=[],g[h]=[];for(var i=0;i<this.gridSizeX;i++){c=e[h*this.gridSizeX+i],d=this.getTile(c,f);var j=hexagonWidth*i;this.gridSizeY%2?j+=hexagonWidth/2*(h%2):j-=hexagonWidth/2*(h%2);var k=hexagonHeight/4*3*h,l=this.add.sprite(j,k,d.spritesheet,d.tile+".png");if(hexagonGroup.add(l),"tileWater"==d.tile){var m=new WaterTile(this,l,h,i);waterTilesArray.push(m),this.hexagonArray[h][i]=m}else{var m=new WalkableTile(this,l,h,i);this.hexagonArray[h][i]=m}g[h][i]=b.walkable[h*this.gridSizeX+i],0==g[h][i]&&(this.hexagonArray[h][i].walkable=!1);var n=this.add.text(j+hexagonWidth/3+5,k+15,h+","+i);n.font="arial",n.fontSize=12,hexagonGroup.add(n)}}pathfinder.setGrid(g,[1]);for(var o,p,q=b.objects,h=0;h<q.length;h++)if(q[h].actions){new InteractiveObject(this,q[h],s)}else{var r=this.getTile(q[h].name,q[h].tilesetid);o=q[h].x,p=this.gridSizeY-q[h].y-1;var s=this.game.make.sprite(q[h].offsetx*hexagonWidth,q[h].offsety*hexagonHeight,r.spritesheet,r.tile+".png");this.hexagonArray[p][o].tileImage.addChild(s),s.anchor.x=.5,s.anchor.y=1}for(var t=b.connected,h=0;h<t.length;h++){var u=this.hexagonArray[this.gridSizeY-t[h].fy-1][t[h].fx];u.actionEnter=this.userSteppedOnExit,u.actionEnterData=t[h];var v=this.game.make.sprite(0,0,"tiles","mapexit.png");u.tileImage.addChild(v)}for(var w=b.actionSpots,h=0;h<w.length;h++)var u=this.hexagonArray[this.gridSizeY-w[h].y-1][w[h].x];hexagonGroup.sort("y",Phaser.Group.SORT_ASCENDING),hexagonGroup.y=(300-hexagonHeight*Math.ceil(this.gridSizeY/2))/2,this.gridSizeY%2==0&&(hexagonGroup.y-=hexagonHeight/4),hexagonGroup.x=(900-Math.ceil(this.gridSizeX)*hexagonWidth)/2,this.gridSizeX%2==0&&(hexagonGroup.x-=hexagonWidth/8),this.playerCharacter||(this.playerCharacter=new MovingCharacter(this,"player"),this.game.add.existing(this.playerCharacter.sprite),this.playerCharacter.setLocationByTile(this.hexagonArray[this.gridSizeY-startpos[2]-1][startpos[1]])),characterGroup.add(this.playerCharacter.sprite),characterGroup.sort("y",Phaser.Group.SORT_ASCENDING),characterGroup.x=hexagonGroup.x,characterGroup.y=hexagonGroup.y,this.neighborLights=[];for(var h=0;40>h;h++){var x=this.add.group(),y=this.game.add.sprite(0,0,"tiles","tileWater_tile.png");this.neighborLights.push(x),x.add(y),hexagonGroup.add(x);var n=this.add.text(25,25,h+"");n.font="arial",n.fontSize=12,x.add(n),x.x=-1e3}},userSteppedOnExit:function(a){this.game.userExit(a)},userExit:function(a){startpos[0]=a.tmap,startpos[1]=a.tx,startpos[2]=a.ty,this.flushEntireMap();var b=this.mapData.maps[startpos[0]];this.createMapTiles(b)},flushEntireMap:function(){hexagonGroup.destroy(),characterGroup.destroy(),this.hexagonArray=[],waterTilesArray=[],walkableArray=[],this.playerCharacter=null},update:function(){var a=this.game.time.elapsed;if(waterTilesArray)for(var b=waterTilesArray.length,c=0;b>c;c++)waterTilesArray[c].step(a);this.game.global.pause||(this.playerCharacter.step(a),this.playerHex=this.checkHex(this.playerCharacter.sprite.x,this.playerCharacter.sprite.y))},showDialog:function(a){this.diagpanel.startDialog(a),this.pauseGame()},showJustText:function(a){this.justTextPopup.showText(a),this.pauseGame()},showJustTextDialog:function(a){this.justTextPopup.showTextFromHandler(a),this.pauseGame()},pauseGame:function(){this.game.global.pause||(this.game.global.pause=!0)},unpauseGame:function(){this.game.global.pause&&(this.game.global.pause=!1)},quitGame:function(){this.state.start("MainMenu")},showPath:function(){if(!this.game.global.pause&&!this.playerCharacter.isMoving&&(moveIndex=this.checkHex(this.input.worldX-hexagonGroup.x,this.input.worldY-hexagonGroup.y),null!=moveIndex))if(moveIndex.walkable){var a=this.checkHex(this.playerCharacter.sprite.x,this.playerCharacter.sprite.y);a&&(pathfinder.setCallbackFunction(this.showPathCallback,this),pathfinder.preparePathCalculation([a.posx,a.posy],[moveIndex.posx,moveIndex.posy]),pathfinder.calculatePath())}else console.log("not walkable")},showPathCallback:function(){this.playerCharacter.isMoving},drawLine:function(){var a=this.checkHex(this.playerCharacter.sprite.x,this.playerCharacter.sprite.y),b=this.checkHex(this.input.worldX-hexagonGroup.x,this.input.worldY-hexagonGroup.y);b&&a&&this.hexHandler.dolines(a,b,!1)},moveHex:function(){this.game.global.pause||(moveIndex=this.checkHex(this.input.worldX-hexagonGroup.x,this.input.worldY-hexagonGroup.y),null!=moveIndex&&(moveIndex.posx%2==1?(this.highlightNeighbor(0,0,-1,moveIndex),this.highlightNeighbor(1,-1,0,moveIndex),this.highlightNeighbor(2,0,1,moveIndex),this.highlightNeighbor(3,1,1,moveIndex),this.highlightNeighbor(4,1,0,moveIndex),this.highlightNeighbor(5,-1,1,moveIndex)):(this.highlightNeighbor(0,-1,-1,moveIndex),this.highlightNeighbor(1,-1,0,moveIndex),this.highlightNeighbor(2,0,1,moveIndex),this.highlightNeighbor(3,1,0,moveIndex),this.highlightNeighbor(4,0,-1,moveIndex),this.highlightNeighbor(5,1,-1,moveIndex))))},highlightNeighbor:function(a,b,c,d){var e=this.getTileByCords(d.posx+b,d.posy+c);null!=e?(this.neighborLights[a].x=e.tileImage.x,this.neighborLights[a].y=e.tileImage.y):(this.neighborLights[a].x=-1e3,this.neighborLights[a].y=0)},highlightpath:function(a,b){null!=this.neighborLights[a]&&(null!=b?(this.neighborLights[a].x=b.tileImage.x,this.neighborLights[a].y=b.tileImage.y):(this.neighborLights[a].x=-1e3,this.neighborLights[a].y=0))},clickedHex:function(){if(!this.game.global.pause&&(moveIndex=this.checkHex(this.input.worldX-hexagonGroup.x,this.input.worldY-hexagonGroup.y),null!=moveIndex&&this.game.currentacion==this.game.WALK&&moveIndex.walkable)){var a=this.checkHex(this.playerCharacter.sprite.x,this.playerCharacter.sprite.y);a&&(pathfinder.setCallbackFunction(this.playercallback,this),pathfinder.preparePathCalculation([a.posx,a.posy],[moveIndex.posx,moveIndex.posy]),pathfinder.calculatePath())}},drawFridges:function(a){for(var b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)b.push(a[c][d]);for(var c=0;c<b.length;c++)this.highlightpath(c,b[c])},playercallback:function(a){a=a||[],this.playerCharacter.setPath(a)},checkHex:function(a,b){if(this.hexagonArray){var c=a%sectorWidth,d=b%sectorHeight,e=Math.floor(a/sectorWidth),f=Math.floor(b/sectorHeight);if(f%2==0?(hexagonHeight/4-c*gradient>d&&(e--,f--),-hexagonHeight/4+c*gradient>d&&f--):c>=hexagonWidth/2?hexagonHeight/2-c*gradient>d&&f--:c*gradient>d?f--:e--,this.gridSizeY%2==0&&f%2==1&&(e++,0>e&&(e=0)),!(0>e||0>f||f>=this.gridSizeY||e>columns[f%2]-1))return this.hexagonArray[f][e]}},getTile:function(a,b){return{tile:this.mapData.tileSets[b][a],spritesheet:this.mapData.tileSets[b].tileset}},getTileByCords:function(a,b){return this.hexagonArray[a]&&this.hexagonArray[a][b]?this.hexagonArray[a][b]:null},addHex:function(a,b,c,d,e){var f=this.add.sprite(d,e,"tiles",c);hexagonGroup.add(f),this.hexagonArray[a][b]=f}};var WalkableTile=function(a,b,c,d){this.game=a,this.walkable=!0,this.openair=!0,this.tileImage=b,this.posx=c,this.posy=d,this.actionEnter=null,this.actionEnterData=null};Object.defineProperty(WalkableTile,"x",{get:function(){return tileImage.x}}),Object.defineProperty(WalkableTile,"y",{get:function(){return tileImage.y}}),WalkableTile.prototype.clicked=function(){},WalkableTile.prototype.enterTile=function(){this.actionEnter&&this.actionEnter(this.actionEnterData)};var WaterTile=function(a,b,c,d){this.posx=c,this.posy=d,this.walkable=!1,this.openair=!0,this.game=a,this.tileImage=b,this.starty=b.y,this.wavemax=-40,this.maxoffsetmax=12,this.maxoffsetmin=0,this.speed=.006,this.direction=1,this.waveSpeed=0,b.y+=this.game.rnd.integerInRange(this.maxoffsetmin,this.maxoffsetmax),this.game.rnd.frac()<.5&&(this.direction=-1),this.level()};WaterTile.prototype.level=function(){var a=this.tileImage.y;a<this.starty+this.maxoffsetmin&&(this.direction=1),a>this.starty+this.maxoffsetmax&&(this.direction=-1,this.waveSpeed=0)},WaterTile.prototype.step=function(a){this.tileImage.y+=this.tileImage.y<this.starty+this.wavemax?this.direction*this.speed*a:this.direction*this.speed*a,this.game.rnd.frac()<.01&&(this.direction*=-1),this.level()},WaterTile.prototype.hitByWave=function(a){this.tileImage.y+=a,this.starty+this.wavemax>this.tileImage&&(this.tileImage.y=this.starty+this.wavemax),this.level()};var MovingWave=function(a){this.handler=a,this.isActive=!1,this.strength=1,this.strengthDecay=0,this.speed=3};MovingWave.prototype.launch=function(a,b,c,d){this.isActive=!0,this.x=a,this.y=b,this.velx=c*this.speed,this.vely=d*this.speed},MovingWave.prototype.step=function(){this.x+=this.velx,this.y+=this.vely,(this.x<0||this.x>900||this.y<0||this.y>600)&&(this.velx*=-1,this.vely*=-1)};var WaveHandler=function(){this.openWaves=[],this.allWaves=[]};WaveHandler.prototype.getWave=function(){var a;return a=this.openWaves.length>0?this.openWaves.pop():new MovingWave(this),this.allWaves.push(a),a.isActive=!0,a},WaveHandler.prototype.returnWave=function(a){this.openWaves.push(a)};var Point=function(a,b){this.x=a,this.y=b};BasicGame.MainMenu=function(){this.music=null,this.playButton=null},BasicGame.MainMenu.prototype={create:function(){this.add.sprite(0,0,"mainmenu"),this.playButton=this.add.button(376,425,"ui",this.startGame,this,"Play Button0001.png","Play Button0002.png","Play Button0002.png","Play Button0001.png"),this.playButton=this.add.button(376,487,"ui",this.gotoInstructions,this,"Instructions Button0001.png","Instructions Button0002.png","Instructions Button0002.png","Instructions Button0001.png")},update:function(){},startGame:function(){this.state.start("Game")},gotoInstructions:function(){this.state.start("Instructions")}},BasicGame.Preloader=function(){this.background=null,this.preloadBar=null,this.ready=!1},BasicGame.Preloader.prototype={preload:function(){this.background=this.add.sprite(0,0,"loadingScreen","bg.png"),this.preloadBar=this.add.sprite(0,278,"loadingScreen","loading_barfront.png"),this.load.atlasJSONHash("ui","assets/simpleui.png","assets/simpleui.json"),this.load.atlasJSONHash("tiles","assets/tiles.png","assets/tiles.json"),this.load.atlasJSONHash("actors","assets/actors.png","assets/actors.json"),this.load.atlasJSONHash("dialogui","assets/dialogui.png","assets/dialogui.json"),this.load.image("loading","assets/loading.png"),this.load.image("mainmenu","assets/mainmenu.png"),this.load.image("mapselect","assets/mapselect.png"),this.load.image("winscreen","assets/winscreen.png"),this.load.image("instructions","assets/instructions.png"),this.load.bitmapFont("badabb","assets/fonts/badabb.png","assets/fonts/badabb.fnt")},create:function(){this.preloadBar.cropEnabled=!1,this.state.start("Game")}};var DialogHandler=function(a,b,c){this.game=a,this.conversations=b,this.actors=c,this.currentConvo,this.playerActor=this.getPlayerActor()};DialogHandler.prototype.startConvo=function(a){if(this.currentConvo=this.getConversationsByID(a),null!=this.currentConvo){var b=this.buildDialogByID(0);if(null!=b)return""==b.current.MenuText&&""==b.current.DialogueText&&(b=this.buildDialogWithDiag(b.links[0])),b}return null},DialogHandler.prototype.getNextDialog=function(a){return a.links.length<=0||null==a.links[0]?null:this.buildDialogByID(a.links[0].DestID)},DialogHandler.prototype.buildDialogByID=function(a){var b=this.getDialogByID(a);return null==b?null:this.buildDialogWithDiag(b)},DialogHandler.prototype.buildDialogWithDiag=function(a){if(null==a)return null;for(var b,c=[],d=a.links.length,e=0;d>e;e++){var b=this.getDialogByID(a.links[e].DestID);null!=b&&c.push(b)}var f=this.getActorByID(a.Actor),g={current:a,links:c,actor:f};return g},DialogHandler.prototype.getDialogByID=function(a){for(var b=this.currentConvo.DialogueEntries.length,c=0;b>c;c++)if(this.currentConvo.DialogueEntries[c].ID==a)return this.currentConvo.DialogueEntries[c];return null},DialogHandler.prototype.getConversationsByID=function(a){for(var b=this.conversations.length,c=0;b>c;c++)if(this.conversations[c].id==a)return this.conversations[c];return null},DialogHandler.prototype.getActorByID=function(a){for(var b=this.actors.length,c=0;b>c;c++)if(this.actors[c].id==a)return this.actors[c];return null},DialogHandler.prototype.getPlayerActor=function(){for(var a=this.actors.length,b=0;a>b;b++)if(this.actors[b].IsPlayer)return this.actors[b];return null};var DialogPanel=function(a,b,c,d){Phaser.Group.call(this,a,d),this.overTint=16733440,this.maingame=b,this.dialogEngine=c;var e=this.game.make.sprite(0,0,"dialogui","dialog_main.png");this.add(e),this.btnPlay1=this.game.make.button(36.95,-22.4,"dialogui",this.play1,this,"dialog_10002.png","dialog_10001.png","dialog_10001.png","dialog_10002.png"),this.btnPlay2=this.game.make.button(37.4,25.25,"dialogui",this.play2,this,"dialog_20002.png","dialog_20001.png","dialog_20001.png","dialog_20002.png"),this.btnPlay3=this.game.make.button(35.95,45.8,"dialogui",this.play3,this,"dialog_30002.png","dialog_30001.png","dialog_30001.png","dialog_30002.png"),this.add(this.btnPlay1),this.add(this.btnPlay3),this.add(this.btnPlay2),this.btnPlay1.events.onInputOver.add(this.buttonOver,this),this.btnPlay2.events.onInputOver.add(this.buttonOver,this),this.btnPlay3.events.onInputOver.add(this.buttonOver,this),this.btnPlay1.input.useHandCursor=!0,this.btnPlay2.input.useHandCursor=!0,this.btnPlay3.input.useHandCursor=!0,this.btnPlay1.events.onInputOut.add(this.buttonOut,this),this.btnPlay2.events.onInputOut.add(this.buttonOut,this),this.btnPlay3.events.onInputOut.add(this.buttonOut,this),this.text1=this.game.make.bitmapText(95,-10,"badabb","1. Check",25),this.text2=this.game.make.bitmapText(95,35,"badabb","2. Match",25),this.text3=this.game.make.bitmapText(95,82,"badabb","3. Mate",25),this.btnPlay1.textRef=this.text1,this.btnPlay2.textRef=this.text2,this.btnPlay3.textRef=this.text3,this.textMain=this.game.make.bitmapText(0,-60,"badabb","Text goes here.",25),this.add(this.textMain),this.add(this.text1),this.add(this.text2),this.add(this.text3),this.x=300,this.y=-1e3};DialogPanel.prototype=Object.create(Phaser.Group.prototype),DialogPanel.constructor=DialogPanel,DialogPanel.prototype.buttonOver=function(a){a.textRef.tint=this.overTint},DialogPanel.prototype.buttonOut=function(a){a.textRef.tint=16777215},DialogPanel.prototype.play1=function(){this.dialogData=this.dialogData.links[0],this.nextDialog()},DialogPanel.prototype.play2=function(){this.dialogData=this.dialogData.links[1],this.nextDialog()},DialogPanel.prototype.play3=function(){this.dialogData=this.dialogData.links[2],this.nextDialog()},DialogPanel.prototype.nextDialog=function(){this.dialogData=this.dialogEngine.getNextDialog(this.dialogData),null==this.dialogData?this.endDialog():this.setupDialog()},DialogPanel.prototype.setupDialog=function(){this.textMain.text=this.dialogData.actor.Name+": "+this.dialogData.current.DialogueText;for(var a=0;3>a;a++)null!=this.dialogData.current.links[a]?(this["btnPlay"+(a+1)].visible=!0,this["btnPlay"+(a+1)].textRef.visible=!0,this["btnPlay"+(a+1)].textRef.text=a+1+". "+this.dialogData.links[a].MenuText):(this["btnPlay"+(a+1)].visible=!1,this["btnPlay"+(a+1)].textRef.visible=!1)},DialogPanel.prototype.startDialog=function(a){this.dialogData=this.dialogEngine.startConvo(a),this.dialogData&&(this.visible=!0,this.y=250,this.setupDialog())},DialogPanel.prototype.endDialog=function(){this.maingame.unpauseGame(),this.visible=!1,this.y=-1e3},ActionButtons=function(a,b,c){Phaser.Group.call(this,a,c),this.currentActive,this.walk={up:null,active:null},this.setButton(0,0,"walkBtn0001.png","walkBtn0002.png",this.walk,this.dowalk),this.use={up:null,active:null},this.setButton(71,0,"useBtn0001.png","useBtn0002.png",this.use,this.douse),this.look={up:null,active:null},this.setButton(142,0,"lookBtn0001.png","lookBtn0002.png",this.look,this.dolook),this.talk={up:null,active:null},this.setButton(212,0,"talkBtn0001.png","talkBtn0002.png",this.talk,this.dotalk),this.dowalk()},ActionButtons.prototype=Object.create(Phaser.Group.prototype),ActionButtons.constructor=ActionButtons,ActionButtons.prototype.setButton=function(a,b,c,d,e,f){e.up=this.game.make.sprite(a,b,"dialogui",c),this.add(e.up),e.up.inputEnabled=!0,e.up.events.onInputDown.add(f,this),e.active=this.game.make.sprite(a,b,"dialogui",d),e.active.visible=!1,this.add(e.active)},ActionButtons.prototype.dowalk=function(){this.disableButton(this.currentActive),this.game.currentacion=this.game.WALK,this.currentActive=this.walk,this.enableButton(this.currentActive)},ActionButtons.prototype.douse=function(){this.disableButton(this.currentActive),this.game.currentacion=this.game.USE,this.currentActive=this.use,this.enableButton(this.currentActive)},ActionButtons.prototype.dolook=function(){this.disableButton(this.currentActive),this.game.currentacion=this.game.LOOK,this.currentActive=this.look,this.enableButton(this.currentActive)},ActionButtons.prototype.dotalk=function(){this.disableButton(this.currentActive),this.game.currentacion=this.game.TALK,this.currentActive=this.talk,this.enableButton(this.currentActive)},ActionButtons.prototype.enableButton=function(a){null!=a&&(a.up.visible=!1,a.active.visible=!0)},ActionButtons.prototype.disableButton=function(a){null!=a&&(a.up.visible=!0,a.active.visible=!1)},JustTextPopup=function(a,b,c,d){Phaser.Group.call(this,a,d),this.dialogEngine=c,this.maingame=b,this.textMain=this.game.make.bitmapText(0,0,"badabb","Text goes here.",25),this.textMain.tint=65535,this.add(this.textMain),this.x=-1e3,this.dialogData},JustTextPopup.prototype=Object.create(Phaser.Group.prototype),JustTextPopup.constructor=JustTextPopup,JustTextPopup.prototype.showText=function(a){this.x=0,this.textMain.text=a,this.dialogData=null,this.game.input.onDown.add(this.nextPopup,this)},JustTextPopup.prototype.showTextFromHandler=function(a){this.dialogData=this.dialogEngine.startConvo(a),this.dialogData&&(this.visible=!0,this.x=0,this.textMain.text=this.dialogData.current.DialogueText,this.game.input.onDown.add(this.nextPopup,this))},JustTextPopup.prototype.nextPopup=function(){return this.dialogData&&(this.dialogData=this.dialogEngine.getNextDialog(this.dialogData.current)),null==this.dialogData?void this.closePopup():void(this.textMain.text=this.dialogData.current.DialogueText)},JustTextPopup.prototype.closePopup=function(){this.dialogData=null,this.x=-1e3,this.game.input.onDown.remove(this.nextPopup,this),this.maingame.unpauseGame()},BarkTextHandler=function(){},BarkTextHandler.prototype.barkOverActor=function(){},BarkTextHandler.prototype.barkOverActor=function(){},BarkTextHandler.prototype.returnBarkToPool=function(){},BarkTextHandler.prototype.cleanupAllBarks=function(){},BarkText=function(){this.textfield,this.timer,this.over},BarkText.prototype=function(){};var EventConv=function(){};EventConv.prototype.removeSelf=function(){},EventConv.prototype.activateEvent=function(){this.maingame.showDialog(this.convid),this.once};var EventnText=function(){},HexHandler=function(a,b){this.maingame=a,this.game=b,this.debug=!0,this.visited=[],this.fringes=[]};HexHandler.prototype.lineTest=function(a,b){var c=new Point(a.tileImage.x+this.maingame.halfHex,a.tileImage.y+this.maingame.halfHex),d=new Point(b.tileImage.x+this.maingame.halfHex,b.tileImage.y+this.maingame.halfHex),e=this.game.math.distance(c.x,c.y,d.x,d.y);e=this.game.math.ceil(e/this.maingame.hexagonWidth)+1;for(var f=[],g=0;e>=g;g++){var h=0==e?0:g/e;f.push(this.lerp_point(c,d,h))}for(var i=0;i<f.length;i++){var j=this.maingame.checkHex(f[i].x,f[i].y);if(null==j)return null;if(!j.walkable)return j}return b},HexHandler.prototype.dolines=function(a,b,c){var d=new Point(a.tileImage.x+this.maingame.halfHex,a.tileImage.y+this.maingame.halfHex),e=new Point(b.tileImage.x+this.maingame.halfHex,b.tileImage.y+this.maingame.halfHex);this.debug&&(this.maingame.graphics.clear(),this.maingame.graphics.lineStyle(10,16767232,1),this.maingame.graphics.moveTo(a.tileImage.x+hexagonGroup.x+this.maingame.halfHex,a.tileImage.y+hexagonGroup.y+this.maingame.halfHex),this.maingame.graphics.lineTo(b.tileImage.x+hexagonGroup.x+this.maingame.halfHex,b.tileImage.y+hexagonGroup.y+this.maingame.halfHex));var f=this.game.math.distance(d.x,d.y,e.x,e.y);f=this.game.math.ceil(f/this.maingame.hexagonWidth)+1;for(var g=[],h=0;f>=h;h++){var i=0==f?0:h/f;g.push(this.lerp_point(d,e,i))}var j=[];this.debug&&(this.maingame.graphics.lineStyle(0),this.maingame.graphics.beginFill(65291,.5));for(var k=0;k<g.length;k++){var l=this.maingame.checkHex(g[k].x,g[k].y);if(this.debug&&this.maingame.graphics.drawCircle(g[k].x+hexagonGroup.x,g[k].y+hexagonGroup.y,10),null!=l){if(!l.walkable&&!c)break;j.push(l),this.debug&&this.maingame.highlightpath(k,l)}}if(this.debug&&this.maingame.graphics.endFill(),this.debug)for(k=j.length;k<this.maingame.neighborLights.length;k++)this.maingame.highlightpath(k,null);return j},HexHandler.prototype.round_point=function(a){return new Point(Math.round(a.x),Math.round(a.y))},HexHandler.prototype.lerp=function(a,b,c){return a+c*(b-a)},HexHandler.prototype.lerp_point=function(a,b,c){return new Point(this.lerp(a.x,b.x,c),this.lerp(a.y,b.y,c))},HexHandler.prototype.doFloodFill=function(a,b){this.visited=[],this.visited.push(a),this.fringes=[],this.fringes.push([a]);for(var c=1;b>=c;c++){this.fringes.push([]);for(var d=0;d<this.fringes[c-1].length;d++){var e=this.fringes[c-1][d];e.posx%2==1?(this.addNeighbor(e,0,-1,c),this.addNeighbor(e,-1,0,c),this.addNeighbor(e,0,1,c),this.addNeighbor(e,1,1,c),this.addNeighbor(e,1,0,c),this.addNeighbor(e,-1,1,c)):(this.addNeighbor(e,-1,-1,c),this.addNeighbor(e,-1,0,c),this.addNeighbor(e,0,1,c),this.addNeighbor(e,1,0,c),this.addNeighbor(e,0,-1,c),this.addNeighbor(e,1,-1,c))}}return this.fringes},HexHandler.prototype.addNeighbor=function(a,b,c,d){b=a.posx+b,c=a.posy+c;var e=this.maingame.getTileByCords(b,c);null!=e&&e.walkable&&-1==this.visited.indexOf(e)&&(this.visited.push(e),this.fringes[d].push(e))},HexHandler.prototype.getFrigesAsArray=function(){for(var a=[],b=0;b<fridges.length;b++)for(var c=0;c<fridges[b].length;c++)a.push(fridges[b][c]);return a},HexHandler.prototype.areTilesNeighbors=function(a,b){var c=a.posx-b.posx,d=a.posy-b.posy;if(a.posx%2==1){if(0==c&&-1==d)return!0;if(0==c&&-1==d)return!0;if(-1==c&&0==d)return!0;if(0==c&&1==d)return!0;if(1==c&&1==d)return!0;if(1==c&&0==d)return!0;if(-1==c&&1==d)return!0}else{if(-1==c&&-1==d)return!0;if(-1==c&&0==d)return!0;if(0==c&&1==d)return!0;if(1==c&&0==d)return!0;if(0==c&&-1==d)return!0;if(1==c&&-1==d)return!0}return!1};var MovingCharacter=function(a,b){this.maingame=a,this.name=b,this.sprite=this.maingame.make.sprite(0,0,"actors","movingPerson2_idle0001.png"),this.sprite.anchor.x=.5,this.sprite.anchor.y=1,this.sprite.animations.add("idle",Phaser.Animation.generateFrameNames("movingPerson2_idle",1,2,".png",4),1,!0,!1),this.sprite.animations.add("walk",Phaser.Animation.generateFrameNames("movingPerson2_walk",1,4,".png",4),8,!0,!1),this.sprite.animations.play("idle"),this.oldTile,this.currentTile,this.path=null,this.pathlocation=0,this.nextTile,this.dir=new Phaser.Point,this.walkspeed=.1875,this.inventory=[]};MovingCharacter.prototype.isMoving=function(){return 0==this.dir.x&&0==this.dir.y?!1:!0},MovingCharacter.prototype.setLocation=function(a,b){this.sprite.x=a,this.sprite.y=b},MovingCharacter.prototype.setLocationByTile=function(a){this.sprite.x=a.tileImage.x+this.maingame.halfHex,this.sprite.y=a.tileImage.y+this.maingame.halfHex,this.oldTile=a,this.currentTile=a},MovingCharacter.prototype.setDirection=function(){this.dir.x=this.nextTile.tileImage.x+this.maingame.halfHex-this.sprite.x,this.dir.y=this.nextTile.tileImage.y+this.maingame.halfHex-this.sprite.y,this.dir.normalize()},MovingCharacter.prototype.setPath=function(a){a&&(a.length<=0||(this.path=a,this.pathlocation=0,this.nextTile=this.maingame.getTileByCords(a[this.pathlocation].x,a[this.pathlocation].y),this.setDirection(),this.sprite.animations.play("walk")))},MovingCharacter.prototype.step=function(a){if(null!=this.path&&this.path.length>0&&(this.currentTile=this.maingame.checkHex(this.sprite.x,this.sprite.y),this.currentTile.posx==this.nextTile.posx&&this.currentTile.posy==this.nextTile.posy))if(this.pathlocation++,this.pathlocation>=this.path.length){this.pathlocation=this.path.length;var b=this.currentTile.tileImage.x+this.maingame.halfHex,c=this.currentTile.tileImage.y+this.maingame.halfHex,d=3;b-d<this.sprite.x&&b+d>this.sprite.x&&c-d<this.sprite.y&&c+d>this.sprite.y&&(this.sprite.x=b,this.sprite.y=c,this.path=null,this.dir.x=0,this.dir.y=0,this.currentTile.enterTile(),this.sprite.animations.play("idle")),this.setDirection()}else this.nextTile=this.maingame.getTileByCords(this.path[this.pathlocation].x,this.path[this.pathlocation].y),this.setDirection();this.sprite.x+=this.dir.x*this.walkspeed*a,this.sprite.y+=this.dir.y*this.walkspeed*a,this.dir.x<0?this.sprite.scale.x=-1:this.dir.x>0&&(this.sprite.scale.x=1)};var InteractiveObject=function(a,b){this.maingame=a,this.game=a.game,this.jsondata=b,this.tileobject,this.actions=[];for(var c=this.jsondata.actions,d=0;d<c.length;d++)"actionconvtrigger"==c[d].type?this.handleActionConvTrigger(c[d]):"actorset"==c[d].type?this.handleActorSet(c[d]):"actiontext"==c[d].type&&this.handleActionText(c[d]);this.setupArt(this.jsondata)};InteractiveObject.prototype.handleActorSet=function(){},InteractiveObject.prototype.handleActionConvTrigger=function(a){var b=a;this.actions[a.trigger]=b},InteractiveObject.prototype.handleActionText=function(){},InteractiveObject.prototype.step=function(){},InteractiveObject.prototype.setupReactToAction=function(){this.tileobject.events.onInputDown.add(handleClick,this)},InteractiveObject.prototype.handleClick=function(){},InteractiveObject.prototype.setupArt=function(){var a=this.maingame.getTile(this.jsondata.name,this.jsondata.tilesetid),b=this.jsondata.x,c=this.maingame.gridSizeY-this.jsondata.y-1;this.tileobject=this.game.make.sprite(this.jsondata.offsetx*this.maingame.hexagonWidth,this.jsondata.offsety*this.maingame.hexagonHeight,a.spritesheet,a.tile+".png"),this.maingame.hexagonArray[c][b].tileImage.addChild(this.tileobject),this.tileobject.anchor.x=.5,this.tileobject.anchor.y=1};var InventoryEngine=function(){};InventoryEngine.prototype.enterInventory=function(){},BarkTextHandler=function(a,b){this.pool=new BasicObjectPool,this.game=a,this.maingame=b},BarkTextHandler.prototype.barkOverActor=function(){},BarkTextHandler.prototype.barkOverActor=function(){},BarkTextHandler.prototype.returnBarkToPool=function(){},BarkTextHandler.prototype.cleanupAllBarks=function(){},BarkText=function(){this.textfield,this.timer,this.over,this.inUse=!1},BarkText.prototype.step=function(){},BarkText.prototype.reset=function(){};var DialogPanel=function(a,b,c,d){Phaser.Group.call(this,a,d),this.overTint=16733440,this.maingame=b,this.dialogEngine=c;var e=this.game.make.sprite(0,0,"dialogui","dialog_main.png");this.add(e),this.btnPlay1=this.game.make.button(36.95,-22.4,"dialogui",this.play1,this,"dialog_10002.png","dialog_10001.png","dialog_10001.png","dialog_10002.png"),this.btnPlay2=this.game.make.button(37.4,25.25,"dialogui",this.play2,this,"dialog_20002.png","dialog_20001.png","dialog_20001.png","dialog_20002.png"),this.btnPlay3=this.game.make.button(35.95,45.8,"dialogui",this.play3,this,"dialog_30002.png","dialog_30001.png","dialog_30001.png","dialog_30002.png"),this.add(this.btnPlay1),this.add(this.btnPlay3),this.add(this.btnPlay2),this.btnPlay1.events.onInputOver.add(this.buttonOver,this),this.btnPlay2.events.onInputOver.add(this.buttonOver,this),this.btnPlay3.events.onInputOver.add(this.buttonOver,this),this.btnPlay1.input.useHandCursor=!0,this.btnPlay2.input.useHandCursor=!0,this.btnPlay3.input.useHandCursor=!0,this.btnPlay1.events.onInputOut.add(this.buttonOut,this),this.btnPlay2.events.onInputOut.add(this.buttonOut,this),this.btnPlay3.events.onInputOut.add(this.buttonOut,this),this.text1=this.game.make.bitmapText(95,-10,"badabb","1. Check",25),this.text2=this.game.make.bitmapText(95,35,"badabb","2. Match",25),this.text3=this.game.make.bitmapText(95,82,"badabb","3. Mate",25),this.btnPlay1.textRef=this.text1,this.btnPlay2.textRef=this.text2,this.btnPlay3.textRef=this.text3,this.textMain=this.game.make.bitmapText(0,-60,"badabb","Text goes here.",25),this.add(this.textMain),this.add(this.text1),this.add(this.text2),this.add(this.text3),this.x=300,this.y=-1e3};DialogPanel.prototype=Object.create(Phaser.Group.prototype),DialogPanel.constructor=DialogPanel,DialogPanel.prototype.buttonOver=function(a){a.textRef.tint=this.overTint},DialogPanel.prototype.buttonOut=function(a){a.textRef.tint=16777215},DialogPanel.prototype.play1=function(){this.dialogData=this.dialogData.links[0],this.nextDialog()},DialogPanel.prototype.play2=function(){this.dialogData=this.dialogData.links[1],this.nextDialog()},DialogPanel.prototype.play3=function(){this.dialogData=this.dialogData.links[2],this.nextDialog()},DialogPanel.prototype.nextDialog=function(){this.dialogData=this.dialogEngine.getNextDialog(this.dialogData),null==this.dialogData?this.endDialog():this.setupDialog()},DialogPanel.prototype.setupDialog=function(){this.textMain.text=this.dialogData.actor.Name+": "+this.dialogData.current.DialogueText;for(var a=0;3>a;a++)null!=this.dialogData.current.links[a]?(this["btnPlay"+(a+1)].visible=!0,this["btnPlay"+(a+1)].textRef.visible=!0,this["btnPlay"+(a+1)].textRef.text=a+1+". "+this.dialogData.links[a].MenuText,this["btnPlay"+(a+1)].textRef.tint=16777215):(this["btnPlay"+(a+1)].visible=!1,this["btnPlay"+(a+1)].textRef.visible=!1,this["btnPlay"+(a+1)].textRef.text="",this["btnPlay"+(a+1)].textRef.tint=16777215)},DialogPanel.prototype.startDialog=function(a){this.dialogData=this.dialogEngine.startConvo(a),this.dialogData&&(this.visible=!0,this.y=250,this.setupDialog())},DialogPanel.prototype.endDialog=function(){this.maingame.unpauseGame(),this.visible=!1,this.y=-1e3},JustTextPopup=function(a,b,c,d){Phaser.Group.call(this,a,d),this.dialogEngine=c,this.maingame=b,this.textMain=this.game.make.bitmapText(0,0,"badabb","Text goes here.",25),this.textMain.tint=65535,this.add(this.textMain),this.x=-1e3,this.dialogData},JustTextPopup.prototype=Object.create(Phaser.Group.prototype),JustTextPopup.constructor=JustTextPopup,JustTextPopup.prototype.showText=function(a){this.x=0,this.textMain.text=a,this.dialogData=null,this.game.input.onDown.add(this.nextPopup,this)},JustTextPopup.prototype.showTextFromHandler=function(a){this.dialogData=this.dialogEngine.startConvo(a),this.dialogData&&(this.visible=!0,this.x=0,this.textMain.text=this.dialogData.current.DialogueText,this.game.input.onDown.add(this.nextPopup,this))},JustTextPopup.prototype.nextPopup=function(){return this.dialogData&&(this.dialogData=this.dialogEngine.getNextDialog(this.dialogData.current)),null==this.dialogData?void this.closePopup():void(this.textMain.text=this.dialogData.current.DialogueText)},JustTextPopup.prototype.closePopup=function(){
this.dialogData=null,this.x=-1e3,this.game.input.onDown.remove(this.nextPopup,this),this.maingame.unpauseGame()};var EasyStar=EasyStar||{};"function"==typeof define&&define.amd&&define("easystar",[],function(){return EasyStar}),"undefined"!=typeof module&&module.exports&&(module.exports=EasyStar),EasyStar.Node=function(a,b,c,d,e){this.parent=a,this.x=b,this.y=c,this.costSoFar=d,this.simpleDistanceToTarget=e,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},EasyStar.Node.OPEN_LIST=0,EasyStar.Node.CLOSED_LIST=1,EasyStar.PriorityQueue=function(a,b){this.length=0;var c=[],d=!1;if(b==EasyStar.PriorityQueue.MAX_HEAP)d=!0;else{if(b!=EasyStar.PriorityQueue.MIN_HEAP)throw b+" not supported.";d=!1}this.insert=function(b){if(!b.hasOwnProperty(a))throw"Cannot insert "+b+" because it does not have a property by the name of "+a+".";c.push(b),this.length++,e(this.length-1)},this.getHighestPriorityElement=function(){return c[0]},this.shiftHighestPriorityElement=function(){if(0===this.length)throw"There are no more elements in your priority queue.";if(1===this.length){var a=c[0];return c=[],this.length=0,a}var b=c[0],d=c.pop();return this.length--,c[0]=d,f(0),b};var e=function(a){if(0!==a){var b=i(a);h(a,b)&&(g(a,b),e(b))}},f=function(a){var b=j(a),c=k(a);if(h(b,a))g(a,b),f(b);else if(h(c,a))g(a,c),f(c);else{if(0==a)return;f(0)}},g=function(a,b){var d=c[a];c[a]=c[b],c[b]=d},h=function(b,e){if(void 0===c[e]||void 0===c[b])return!1;var f,g;return"function"==typeof c[b][a]?(f=c[b][a](),g=c[e][a]()):(f=c[b][a],g=c[e][a]),d?f>g?!0:!1:g>f?!0:!1},i=function(a){return Math.floor(a/2)-1},j=function(a){return 2*a+1},k=function(a){return 2*a+2}},EasyStar.PriorityQueue.MAX_HEAP=0,EasyStar.PriorityQueue.MIN_HEAP=1,EasyStar.instance=function(){this.isDoneCalculating=!0,this.pointsToAvoid={},this.startX,this.callback,this.callbackObj,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},EasyStar.js=function(){var a,b,c,d=10,e={},f={},g=[],h=Number.MAX_VALUE;this.setAcceptableTiles=function(a){a instanceof Array?c=a:!isNaN(parseFloat(a))&&isFinite(a)&&(c=[a])},this.setGrid=function(b){a=b;for(var c=0;c<a[0].length;c++)for(var d=0;d<a.length;d++)f[a[d][c]]||(f[a[d][c]]=1)},this.setTileCost=function(a,b){f[a]=b},this.setIterationsPerCalculation=function(a){h=a},this.avoidAdditionalPoint=function(a,b){e[a+"_"+b]=1},this.stopAvoidingAdditionalPoint=function(a,b){delete e[a+"_"+b]},this.stopAvoidingAllAdditionalPoints=function(){e={}},this.findPath=function(b,e,f,h,i,j){if(void 0===c)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===a)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(0>b||0>e||0>f||0>f||b>a.length-1||e>a[0].length-1||f>a.length-1||h>a[0].length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(b===f&&e===h)return void i.apply(j,[[]]);for(var l=a[f][h],m=!1,n=0;n<c.length;n++)if(l===c[n]){m=!0;break}if(m===!1)return void i.apply(j,[null]);var o=new EasyStar.instance;o.openList=new EasyStar.PriorityQueue("bestGuessDistance",EasyStar.PriorityQueue.MIN_HEAP),o.isDoneCalculating=!1,o.nodeHash={},o.startX=b,o.startY=e,o.endX=f,o.endY=h,o.callback=i,o.callbackObj=j,o.openList.insert(k(o,o.startX,o.startY,null,d)),g.push(o)},this.calculate=function(){if(0!==g.length&&void 0!==a&&void 0!==c)for(b=0;h>b;b++){if(0===g.length)return;if(0!==g[0].openList.length){var d=g[0].openList.shiftHighestPriorityElement();if(d.list=EasyStar.Node.CLOSED_LIST,d.y%2==1){if(i(d,0,-1))continue;if(i(d,-1,0))continue;if(i(d,0,1))continue;if(i(d,1,1))continue;if(i(d,1,0))continue;if(i(d,-1,1))continue}else{if(i(d,-1,-1))continue;if(i(d,-1,0))continue;if(i(d,0,1))continue;if(i(d,1,0))continue;if(i(d,0,-1))continue;if(i(d,1,-1))continue}}else console.log("can't find path"),g[0].callback.apply(g[0].callbackObj,[path]),g.shift()}};var i=function(b,c,e){return b.x+c>-1&&b.x+c<a.length&&b.y+e>-1&&b.y+e<a[0].length&&j(g[0],b,c,e,d*f[a[b.x+c][b.y+e]]),g[0].isDoneCalculating===!0?(g.shift(),!0):!1},j=function(b,d,f,g,h){var i=d.x+f,j=d.y+g;if(void 0===e[i+"_"+j]){if(b.endX===i&&b.endY===j){b.isDoneCalculating=!0;var l=[],m=0;l[m]={x:i,y:j},m++,l[m]={x:d.x,y:d.y},m++;for(var n=d.parent;null!=n;)l[m]={x:n.x,y:n.y},m++,n=n.parent;l.reverse(),b.callback.apply(b.callbackObj,[l])}for(var o=0;o<c.length;o++)if(a[i][j]===c[o]){var p=k(b,i,j,d,h);void 0===p.list?(p.list=EasyStar.Node.OPEN_LIST,b.openList.insert(p)):p.list===EasyStar.Node.OPEN_LIST&&d.costSoFar+h<p.costSoFar&&(p.costSoFar=d.costSoFar+h,p.parent=d);break}}},k=function(a,b,c,d,e){if(void 0!==a.nodeHash[b+"_"+c])return a.nodeHash[b+"_"+c];var f=l(b,c,a.endX,a.endY);if(null!==d)var g=d.costSoFar+e;else g=f;var h=new EasyStar.Node(d,b,c,g,f);return a.nodeHash[b+"_"+c]=h,h},l=function(a,b,c,e){return Math.sqrt(Math.abs(c-a)*Math.abs(c-a)+Math.abs(e-b)*Math.abs(e-b))*d}},Phaser.Plugin.PathFinderPlugin=function(a){if("object"!=typeof EasyStar)throw new Error("Easystar is not defined!");this.parent=a,this._easyStar=new EasyStar.js,this._grid=null,this._callback=null,this._callbackObj=null,this._prepared=!1,this._walkables=[0]},Phaser.Plugin.PathFinderPlugin.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.PathFinderPlugin.prototype.constructor=Phaser.Plugin.PathFinderPlugin,Phaser.Plugin.PathFinderPlugin.prototype.setGrid=function(a,b,c){c=c||null,this._grid=[];for(var d=0;d<a.length;d++){this._grid[d]=[];for(var e=0;e<a[d].length;e++)this._grid[d][e]=a[d][e]?a[d][e]:0}for(this._walkables=b,this._easyStar.setGrid(this._grid),this._easyStar.setAcceptableTiles(this._walkables),d=0;d<b.length;d++)this.setTileCost(b[d],1);null!==c&&this._easyStar.setIterationsPerCalculation(c)},Phaser.Plugin.PathFinderPlugin.prototype.setTileCost=function(a,b){this._easyStar.setTileCost(a,b)},Phaser.Plugin.PathFinderPlugin.prototype.setCallbackFunction=function(a,b){this._callback=a,this._callbackObj=b},Phaser.Plugin.PathFinderPlugin.prototype.preparePathCalculation=function(a,b){if(null===this._callback||"function"!=typeof this._callback)throw new Error("No Callback set!");var c=a[0],d=a[1],e=b[0],f=b[1];this._easyStar.findPath(c,d,e,f,this._callback,this._callbackObj),this._prepared=!0},Phaser.Plugin.PathFinderPlugin.prototype.calculatePath=function(){if(null===this._prepared)throw new Error("no Calculation prepared!");this._easyStar.calculate()};var BaseTile=function(a,b,c,d,e,f,g,h){Phaser.Sprite.call(this,a,f,g,c,b),this.game=a,this.maingame=h};BaseTile.prototype=Object.create(Phaser.Sprite.prototype),BaseTile.constructor=WalkableTile,BaseTile.prototype.callFunction=function(a,b){var c=window[a];"function"==typeof c&&c.apply(null,b)};var WalkableTile=function(a,b,c,d,e,f,g,h){BaseTile.call(this,a,b,c,d,e,f,g,h),this.walkable=!0,this.openair=!0,this.posx=d,this.posy=e,this.eventDispatcher};WalkableTile.prototype=Object.create(BaseTile.prototype),WalkableTile.constructor=WalkableTile,WalkableTile.prototype.enterTile=function(){this.eventDispatcher&&this.eventDispatcher.doAction("OnEnter")};var WaterTile=function(a,b,c,d,e,f,g){Phaser.Sprite.call(this,a,f,g,c,b),this.game=a,this.posx=d,this.posy=e,this.walkable=!1,this.openair=!0,this.starty=g,this.wavemax=-40,this.maxoffsetmax=12,this.maxoffsetmin=0,this.speed=.006,this.direction=1,this.waveSpeed=0,this.y+=this.game.rnd.integerInRange(this.maxoffsetmin,this.maxoffsetmax),this.game.rnd.frac()<.5&&(this.direction=-1),this.level()};WaterTile.prototype=Object.create(Phaser.Sprite.prototype),WaterTile.constructor=WaterTile,WaterTile.prototype.level=function(){var a=this.y;a<this.starty+this.maxoffsetmin&&(this.direction=1),a>this.starty+this.maxoffsetmax&&(this.direction=-1,this.waveSpeed=0)},WaterTile.prototype.step=function(a){this.y+=this.y<this.starty+this.wavemax?this.direction*this.speed*a:this.direction*this.speed*a,this.game.rnd.frac()<.01&&(this.direction*=-1),this.level()},WaterTile.prototype.hitByWave=function(a){this.y+=a,this.starty+this.wavemax>this.tileImage&&(this.y=this.starty+this.wavemax),this.level()};