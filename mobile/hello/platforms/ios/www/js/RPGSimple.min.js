function saveState(a){window.localStorage.setItem("gameState",JSON.stringify(a))}function restoreState(){var a=window.localStorage.getItem("gameState");return a?JSON.parse(a):null}var BasicGame={};BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.game.device.desktop?this.scale.pageAlignHorizontally=!0:(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.setMinMax(480,260,1024,768),this.scale.forceLandscape=!0,this.scale.pageAlignHorizontally=!0)},preload:function(){this.load.atlasJSONHash("loadingScreen","assets/loading.png","assets/loading.json")},create:function(){this.state.start("Preloader")}},BasicGame.Instructions=function(){this.music=null,this.playButton=null},BasicGame.Instructions.prototype={create:function(){this.add.sprite(0,0,"instructions"),this.playButton=this.add.button(177,529,"ui",this.returnToMain,this,"OK Button0001.png","OK Button0002.png","OK Button0002.png","OK Button0001.png")},update:function(){},returnToMain:function(){this.state.start("MainMenu")}},BasicGame.GameWave=function(){this.game,this.add,this.camera,this.cache,this.input,this.load,this.math,this.sound,this.stage,this.time,this.tweens,this.state,this.world,this.particles,this.physics,this.rnd,this.playerCharacter,this.playerHex,this.halfHex=hexagonWidth/2,this.diagpanel,this.activeButtons,this.neighborLights=[],this.hexagonWidth=63,this.hexagonHeight=65,this.gridSizeX=30,this.gridSizeY=15,this.hexagonArray=[],this.hexHandler,this.graphics,this.justTextPopup};var hexagonWidth=63,hexagonHeight=65,columns=[Math.ceil(this.gridSizeX/2),Math.floor(this.gridSizeX/2)],moveIndex,sectorWidth=hexagonWidth,sectorHeight=hexagonHeight/4*3,gradient=hexagonHeight/4/(hexagonWidth/2),uiGroup,hexagonGroup,characterGroup,waterTilesArray=[],interactiveObjects=[],tiles=["tileGrass.png","tileAutumn.png","tileDirt.png","tileMagic.png","tileRock.png","tileSand.png","tileSnow.png","tileStone.png"],target,replacement,startTile,waveHandler,map,startpos,mapData,pathfinder;BasicGame.GameWave.prototype={preload:function(){this.load.text("map","assets/desertIsland.json")},create:function(){this.stage.backgroundColor="#666666",pathfinder=this.game.plugins.add(Phaser.Plugin.PathFinderPlugin),this.hexagonArray=[],waterTilesArray=[],interactiveObjects=[],this.uiGroup=this.add.group(),this.mapData=JSON.parse(this.game.cache.getText("map")),startpos=this.mapData.startPos.split("_");var a=this.mapData.maps[startpos[0]];this.createMapTiles(a),this.dialoghandler=new DialogHandler(this,this.mapData.data.Conversations,this.mapData.data.Actors),this.diagpanel=new DialogPanel(this.game,this,this.dialoghandler),this.game.add.existing(this.diagpanel),this.uiGroup.add(this.diagpanel),this.justTextPopup=new JustTextPopup(this.game,this,this.dialoghandler),this.game.add.existing(this.justTextPopup),this.uiGroup.add(this.justTextPopup),this.input.onDown.add(this.clickedHex,this),this.activeButtons=new ActionButtons(this.game,this),this.activeButtons.y=350,this.game.add.existing(this.activeButtons),this.uiGroup.add(this.activeButtons),waveHandler=new WaveHandler,this.hexHandler=new HexHandler(this,this.game),this.graphics=this.game.add.graphics(0,0),this.uiGroup.add(this.graphics),this.showJustTextDialog(3)},createMapTiles:function(a){this.hexagonArray=[],g=[],hexagonGroup=this.add.group(),characterGroup=this.add.group(),this.uiGroup.parent.bringToTop(this.uiGroup);var b=a[0];this.gridSizeY=b.height,this.gridSizeX=b.width;for(var c,d,e=b.data,f=b.tilesetid,g=[],h=0;h<this.gridSizeY;h++){this.hexagonArray[h]=[],g[h]=[];for(var i=0;i<this.gridSizeX;i++){c=e[h*this.gridSizeX+i],d=this.getTile(c,f);var j=hexagonWidth*i;this.gridSizeY%2?j+=hexagonWidth/2*(h%2):j-=hexagonWidth/2*(h%2);var k=hexagonHeight/4*3*h,l=this.add.sprite(j,k,d.spritesheet,d.tile+".png");if(hexagonGroup.add(l),"tileWater"==d.tile){var m=new WaterTile(this,l,h,i);waterTilesArray.push(m),this.hexagonArray[h][i]=m}else{var m=new WalkableTile(this,l,h,i);this.hexagonArray[h][i]=m}g[h][i]=b.walkable[h*this.gridSizeX+i],0==g[h][i]&&(this.hexagonArray[h][i].walkable=!1);var n=this.add.text(j+hexagonWidth/3+5,k+15,h+","+i);n.font="arial",n.fontSize=12,hexagonGroup.add(n)}}pathfinder.setGrid(g,[1]);for(var o,p,q=b.objects,h=0;h<q.length;h++)if(q[h].actions){new InteractiveObject(this,q[h],s)}else{var r=this.getTile(q[h].name,q[h].tilesetid);o=q[h].x,p=this.gridSizeY-q[h].y-1;var s=this.game.make.sprite(q[h].offsetx*hexagonWidth,q[h].offsety*hexagonHeight,r.spritesheet,r.tile+".png");this.hexagonArray[p][o].tileImage.addChild(s),s.anchor.x=.5,s.anchor.y=1}for(var t=b.connected,h=0;h<t.length;h++){var u=this.hexagonArray[this.gridSizeY-t[h].fy-1][t[h].fx];u.actionEnter=this.userSteppedOnExit,u.actionEnterData=t[h];var v=this.game.make.sprite(0,0,"tiles","mapexit.png");u.tileImage.addChild(v)}for(var w=b.actionSpots,h=0;h<w.length;h++)var u=this.hexagonArray[this.gridSizeY-w[h].y-1][w[h].x];hexagonGroup.sort("y",Phaser.Group.SORT_ASCENDING),hexagonGroup.y=(300-hexagonHeight*Math.ceil(this.gridSizeY/2))/2,this.gridSizeY%2==0&&(hexagonGroup.y-=hexagonHeight/4),hexagonGroup.x=(900-Math.ceil(this.gridSizeX)*hexagonWidth)/2,this.gridSizeX%2==0&&(hexagonGroup.x-=hexagonWidth/8),this.playerCharacter||(this.playerCharacter=new MovingCharacter(this,"player"),this.game.add.existing(this.playerCharacter.sprite),this.playerCharacter.setLocationByTile(this.hexagonArray[this.gridSizeY-startpos[2]-1][startpos[1]])),characterGroup.add(this.playerCharacter.sprite),characterGroup.sort("y",Phaser.Group.SORT_ASCENDING),characterGroup.x=hexagonGroup.x,characterGroup.y=hexagonGroup.y,this.neighborLights=[];for(var h=0;40>h;h++){var x=this.add.group(),y=this.game.add.sprite(0,0,"tiles","tileWater_tile.png");this.neighborLights.push(x),x.add(y),hexagonGroup.add(x);var n=this.add.text(25,25,h+"");n.font="arial",n.fontSize=12,x.add(n),x.x=-1e3}},userSteppedOnExit:function(a){this.game.userExit(a)},userExit:function(a){startpos[0]=a.tmap,startpos[1]=a.tx,startpos[2]=a.ty,this.flushEntireMap();var b=this.mapData.maps[startpos[0]];this.createMapTiles(b)},flushEntireMap:function(){hexagonGroup.destroy(),characterGroup.destroy(),this.hexagonArray=[],waterTilesArray=[],walkableArray=[],this.playerCharacter=null},update:function(){var a=this.game.time.elapsed;if(waterTilesArray)for(var b=waterTilesArray.length,c=0;b>c;c++)waterTilesArray[c].step(a);this.game.global.pause||(this.playerCharacter.step(a),this.playerHex=this.checkHex(this.playerCharacter.sprite.x,this.playerCharacter.sprite.y))},showDialog:function(a){this.diagpanel.startDialog(a),this.pauseGame()},showJustText:function(a){this.justTextPopup.showText(a),this.pauseGame()},showJustTextDialog:function(a){this.justTextPopup.showTextFromHandler(a),this.pauseGame()},pauseGame:function(){this.game.global.pause||(this.game.global.pause=!0)},unpauseGame:function(){this.game.global.pause&&(this.game.global.pause=!1)},quitGame:function(){this.state.start("MainMenu")},showPath:function(){if(!this.game.global.pause&&!this.playerCharacter.isMoving&&(moveIndex=this.checkHex(this.input.worldX-hexagonGroup.x,this.input.worldY-hexagonGroup.y),null!=moveIndex))if(moveIndex.walkable){var a=this.checkHex(this.playerCharacter.sprite.x,this.playerCharacter.sprite.y);a&&(pathfinder.setCallbackFunction(this.showPathCallback,this),pathfinder.preparePathCalculation([a.posx,a.posy],[moveIndex.posx,moveIndex.posy]),pathfinder.calculatePath())}else console.log("not walkable")},showPathCallback:function(){this.playerCharacter.isMoving},drawLine:function(){var a=this.checkHex(this.playerCharacter.sprite.x,this.playerCharacter.sprite.y),b=this.checkHex(this.input.worldX-hexagonGroup.x,this.input.worldY-hexagonGroup.y);b&&a&&this.hexHandler.dolines(a,b,!1)},moveHex:function(){this.game.global.pause||(moveIndex=this.checkHex(this.input.worldX-hexagonGroup.x,this.input.worldY-hexagonGroup.y),null!=moveIndex&&(moveIndex.posx%2==1?(this.highlightNeighbor(0,0,-1,moveIndex),this.highlightNeighbor(1,-1,0,moveIndex),this.highlightNeighbor(2,0,1,moveIndex),this.highlightNeighbor(3,1,1,moveIndex),this.highlightNeighbor(4,1,0,moveIndex),this.highlightNeighbor(5,-1,1,moveIndex)):(this.highlightNeighbor(0,-1,-1,moveIndex),this.highlightNeighbor(1,-1,0,moveIndex),this.highlightNeighbor(2,0,1,moveIndex),this.highlightNeighbor(3,1,0,moveIndex),this.highlightNeighbor(4,0,-1,moveIndex),this.highlightNeighbor(5,1,-1,moveIndex))))},highlightNeighbor:function(a,b,c,d){var e=this.getTileByCords(d.posx+b,d.posy+c);null!=e?(this.neighborLights[a].x=e.tileImage.x,this.neighborLights[a].y=e.tileImage.y):(this.neighborLights[a].x=-1e3,this.neighborLights[a].y=0)},highlightpath:function(a,b){null!=this.neighborLights[a]&&(null!=b?(this.neighborLights[a].x=b.tileImage.x,this.neighborLights[a].y=b.tileImage.y):(this.neighborLights[a].x=-1e3,this.neighborLights[a].y=0))},clickedHex:function(){if(!this.game.global.pause&&(moveIndex=this.checkHex(this.input.worldX-hexagonGroup.x,this.input.worldY-hexagonGroup.y),null!=moveIndex&&this.game.currentacion==this.game.WALK&&moveIndex.walkable)){var a=this.checkHex(this.playerCharacter.sprite.x,this.playerCharacter.sprite.y);a&&(pathfinder.setCallbackFunction(this.playercallback,this),pathfinder.preparePathCalculation([a.posx,a.posy],[moveIndex.posx,moveIndex.posy]),pathfinder.calculatePath())}},drawFridges:function(a){for(var b=[],c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)b.push(a[c][d]);for(var c=0;c<b.length;c++)this.highlightpath(c,b[c])},playercallback:function(a){a=a||[],this.playerCharacter.setPath(a)},checkHex:function(a,b){if(this.hexagonArray){var c=a%sectorWidth,d=b%sectorHeight,e=Math.floor(a/sectorWidth),f=Math.floor(b/sectorHeight);if(f%2==0?(hexagonHeight/4-c*gradient>d&&(e--,f--),-hexagonHeight/4+c*gradient>d&&f--):c>=hexagonWidth/2?hexagonHeight/2-c*gradient>d&&f--:c*gradient>d?f--:e--,this.gridSizeY%2==0&&f%2==1&&(e++,0>e&&(e=0)),!(0>e||0>f||f>=this.gridSizeY||e>columns[f%2]-1))return this.hexagonArray[f][e]}},getTile:function(a,b){return{tile:this.mapData.tileSets[b][a],spritesheet:this.mapData.tileSets[b].tileset}},getTileByCords:function(a,b){return this.hexagonArray[a]&&this.hexagonArray[a][b]?this.hexagonArray[a][b]:null},addHex:function(a,b,c,d,e){var f=this.add.sprite(d,e,"tiles",c);hexagonGroup.add(f),this.hexagonArray[a][b]=f}};var WalkableTile=function(a,b,c,d){this.game=a,this.walkable=!0,this.openair=!0,this.tileImage=b,this.posx=c,this.posy=d,this.actionEnter=null,this.actionEnterData=null};Object.defineProperty(WalkableTile,"x",{get:function(){return tileImage.x}}),Object.defineProperty(WalkableTile,"y",{get:function(){return tileImage.y}}),WalkableTile.prototype.clicked=function(){},WalkableTile.prototype.enterTile=function(){this.actionEnter&&this.actionEnter(this.actionEnterData)};var WaterTile=function(a,b,c,d){this.posx=c,this.posy=d,this.walkable=!1,this.openair=!0,this.game=a,this.tileImage=b,this.starty=b.y,this.wavemax=-40,this.maxoffsetmax=12,this.maxoffsetmin=0,this.speed=.006,this.direction=1,this.waveSpeed=0,b.y+=this.game.rnd.integerInRange(this.maxoffsetmin,this.maxoffsetmax),this.game.rnd.frac()<.5&&(this.direction=-1),this.level()};WaterTile.prototype.level=function(){var a=this.tileImage.y;a<this.starty+this.maxoffsetmin&&(this.direction=1),a>this.starty+this.maxoffsetmax&&(this.direction=-1,this.waveSpeed=0)},WaterTile.prototype.step=function(a){this.tileImage.y+=this.tileImage.y<this.starty+this.wavemax?this.direction*this.speed*a:this.direction*this.speed*a,this.game.rnd.frac()<.01&&(this.direction*=-1),this.level()},WaterTile.prototype.hitByWave=function(a){this.tileImage.y+=a,this.starty+this.wavemax>this.tileImage&&(this.tileImage.y=this.starty+this.wavemax),this.level()};var MovingWave=function(a){this.handler=a,this.isActive=!1,this.strength=1,this.strengthDecay=0,this.speed=3};MovingWave.prototype.launch=function(a,b,c,d){this.isActive=!0,this.x=a,this.y=b,this.velx=c*this.speed,this.vely=d*this.speed},MovingWave.prototype.step=function(){this.x+=this.velx,this.y+=this.vely,(this.x<0||this.x>900||this.y<0||this.y>600)&&(this.velx*=-1,this.vely*=-1)};var WaveHandler=function(){this.openWaves=[],this.allWaves=[]};WaveHandler.prototype.getWave=function(){var a;return a=this.openWaves.length>0?this.openWaves.pop():new MovingWave(this),this.allWaves.push(a),a.isActive=!0,a},WaveHandler.prototype.returnWave=function(a){this.openWaves.push(a)};var Point=function(a,b){this.x=a,this.y=b};BasicGame.MainMenu=function(){this.music=null,this.playButton=null},BasicGame.MainMenu.prototype={create:function(){this.add.sprite(0,0,"mainmenu"),this.playButton=this.add.button(376,425,"ui",this.startGame,this,"Play Button0001.png","Play Button0002.png","Play Button0002.png","Play Button0001.png"),this.playButton=this.add.button(376,487,"ui",this.gotoInstructions,this,"Instructions Button0001.png","Instructions Button0002.png","Instructions Button0002.png","Instructions Button0001.png")},update:function(){},startGame:function(){this.state.start("Game")},gotoInstructions:function(){this.state.start("Instructions")}},BasicGame.Preloader=function(){this.background=null,this.preloadBar=null,this.ready=!1},BasicGame.Preloader.prototype={preload:function(){this.background=this.add.sprite(0,0,"loadingScreen","bg.png"),this.preloadBar=this.add.sprite(0,278,"loadingScreen","loading_barfront.png"),this.load.atlasJSONHash("ui","assets/simpleui.png","assets/simpleui.json"),this.load.atlasJSONHash("tiles","assets/tiles.png","assets/tiles.json"),this.load.atlasJSONHash("actors","assets/actors.png","assets/actors.json"),this.load.atlasJSONHash("dialogui","assets/dialogui.png","assets/dialogui.json"),this.load.image("loading","assets/loading.png"),this.load.image("mainmenu","assets/mainmenu.png"),this.load.image("mapselect","assets/mapselect.png"),this.load.image("winscreen","assets/winscreen.png"),this.load.image("instructions","assets/instructions.png"),this.load.bitmapFont("badabb","assets/fonts/badabb.png","assets/fonts/badabb.fnt")},create:function(){this.preloadBar.cropEnabled=!1,this.state.start("Game")}};var DialogHandler=function(a,b,c){this.game=a,this.conversations=b,this.actors=c,this.currentConvo,this.playerActor=this.getPlayerActor()};DialogHandler.prototype.startConvo=function(a){if(this.currentConvo=this.getConversationsByID(a),null!=this.currentConvo){var b=this.buildDialogByID(0);if(null!=b)return""==b.current.MenuText&&""==b.current.DialogueText&&(b=this.buildDialogWithDiag(b.links[0])),b}return null},DialogHandler.prototype.getNextDialog=function(a){return a.links.length<=0||null==a.links[0]?null:this.buildDialogByID(a.links[0].DestID)},DialogHandler.prototype.buildDialogByID=function(a){var b=this.getDialogByID(a);return null==b?null:this.buildDialogWithDiag(b)},DialogHandler.prototype.buildDialogWithDiag=function(a){if(null==a)return null;for(var b,c=[],d=a.links.length,e=0;d>e;e++){var b=this.getDialogByID(a.links[e].DestID);null!=b&&c.push(b)}var f=this.getActorByID(a.Actor),g={current:a,links:c,actor:f};return g},DialogHandler.prototype.getDialogByID=function(a){for(var b=this.currentConvo.DialogueEntries.length,c=0;b>c;c++)if(this.currentConvo.DialogueEntries[c].ID==a)return this.currentConvo.DialogueEntries[c];return null},DialogHandler.prototype.getConversationsByID=function(a){for(var b=this.conversations.length,c=0;b>c;c++)if(this.conversations[c].id==a)return this.conversations[c];return null},DialogHandler.prototype.getActorByID=function(a){for(var b=this.actors.length,c=0;b>c;c++)if(this.actors[c].id==a)return this.actors[c];return null},DialogHandler.prototype.getPlayerActor=function(){for(var a=this.actors.length,b=0;a>b;b++)if(this.actors[b].IsPlayer)return this.actors[b];return null};var DialogPanel=function(a,b,c,d){Phaser.Group.call(this,a,d),this.overTint=16733440,this.maingame=b,this.dialogEngine=c;var e=this.game.make.sprite(0,0,"dialogui","dialog_main.png");this.add(e),this.btnPlay1=this.game.make.button(36.95,-22.4,"dialogui",this.play1,this,"dialog_10002.png","dialog_10001.png","dialog_10001.png","dialog_10002.png"),this.btnPlay2=this.game.make.button(37.4,25.25,"dialogui",this.play2,this,"dialog_20002.png","dialog_20001.png","dialog_20001.png","dialog_20002.png"),this.btnPlay3=this.game.make.button(35.95,45.8,"dialogui",this.play3,this,"dialog_30002.png","dialog_30001.png","dialog_30001.png","dialog_30002.png"),this.add(this.btnPlay1),this.add(this.btnPlay3),this.add(this.btnPlay2),this.btnPlay1.events.onInputOver.add(this.buttonOver,this),this.btnPlay2.events.onInputOver.add(this.buttonOver,this),this.btnPlay3.events.onInputOver.add(this.buttonOver,this),this.btnPlay1.input.useHandCursor=!0,this.btnPlay2.input.useHandCursor=!0,this.btnPlay3.input.useHandCursor=!0,this.btnPlay1.events.onInputOut.add(this.buttonOut,this),this.btnPlay2.events.onInputOut.add(this.buttonOut,this),this.btnPlay3.events.onInputOut.add(this.buttonOut,this),this.text1=this.game.make.bitmapText(95,-10,"badabb","1. Check",25),this.text2=this.game.make.bitmapText(95,35,"badabb","2. Match",25),this.text3=this.game.make.bitmapText(95,82,"badabb","3. Mate",25),this.btnPlay1.textRef=this.text1,this.btnPlay2.textRef=this.text2,this.btnPlay3.textRef=this.text3,this.textMain=this.game.make.bitmapText(0,-60,"badabb","Text goes here.",25),this.add(this.textMain),this.add(this.text1),this.add(this.text2),this.add(this.text3),this.x=300,this.y=-1e3};DialogPanel.prototype=Object.create(Phaser.Group.prototype),DialogPanel.constructor=DialogPanel,DialogPanel.prototype.buttonOver=function(a){a.textRef.tint=this.overTint},DialogPanel.prototype.buttonOut=function(a){a.textRef.tint=16777215},DialogPanel.prototype.play1=function(){this.dialogData=this.dialogData.links[0],this.nextDialog()},DialogPanel.prototype.play2=function(){this.dialogData=this.dialogData.links[1],this.nextDialog()},DialogPanel.prototype.play3=function(){this.dialogData=this.dialogData.links[2],this.nextDialog()},DialogPanel.prototype.nextDialog=function(){this.dialogData=this.dialogEngine.getNextDialog(this.dialogData),null==this.dialogData?this.endDialog():this.setupDialog()},DialogPanel.prototype.setupDialog=function(){this.textMain.text=this.dialogData.actor.Name+": "+this.dialogData.current.DialogueText;for(var a=0;3>a;a++)null!=this.dialogData.current.links[a]?(this["btnPlay"+(a+1)].visible=!0,this["btnPlay"+(a+1)].textRef.visible=!0,this["btnPlay"+(a+1)].textRef.text=a+1+". "+this.dialogData.links[a].MenuText):(this["btnPlay"+(a+1)].visible=!1,this["btnPlay"+(a+1)].textRef.visible=!1)},DialogPanel.prototype.startDialog=function(a){this.dialogData=this.dialogEngine.startConvo(a),this.dialogData&&(this.visible=!0,this.y=250,this.setupDialog())},DialogPanel.prototype.endDialog=function(){this.maingame.unpauseGame(),this.visible=!1,this.y=-1e3},ActionButtons=function(a,b,c){Phaser.Group.call(this,a,c),this.currentActive,this.walk={up:null,active:null},this.setButton(0,0,"walkBtn0001.png","walkBtn0002.png",this.walk,this.dowalk),this.use={up:null,active:null},this.setButton(71,0,"useBtn0001.png","useBtn0002.png",this.use,this.douse),this.look={up:null,active:null},this.setButton(142,0,"lookBtn0001.png","lookBtn0002.png",this.look,this.dolook),this.talk={up:null,active:null},this.setButton(212,0,"talkBtn0001.png","talkBtn0002.png",this.talk,this.dotalk),this.dowalk()},ActionButtons.prototype=Object.create(Phaser.Group.prototype),ActionButtons.constructor=ActionButtons,ActionButtons.prototype.setButton=function(a,b,c,d,e,f){e.up=this.game.make.sprite(a,b,"dialogui",c),this.add(e.up),e.up.inputEnabled=!0,e.up.events.onInputDown.add(f,this),e.active=this.game.make.sprite(a,b,"dialogui",d),e.active.visible=!1,this.add(e.active)},ActionButtons.prototype.dowalk=function(){this.disableButton(this.currentActive),this.game.currentacion=this.game.WALK,this.currentActive=this.walk,this.enableButton(this.currentActive)},ActionButtons.prototype.douse=function(){this.disableButton(this.currentActive),this.game.currentacion=this.game.USE,this.currentActive=this.use,this.enableButton(this.currentActive)},ActionButtons.prototype.dolook=function(){this.disableButton(this.currentActive),this.game.currentacion=this.game.LOOK,this.currentActive=this.look,this.enableButton(this.currentActive)},ActionButtons.prototype.dotalk=function(){this.disableButton(this.currentActive),this.game.currentacion=this.game.TALK,this.currentActive=this.talk,this.enableButton(this.currentActive)},ActionButtons.prototype.enableButton=function(a){null!=a&&(a.up.visible=!1,a.active.visible=!0)},ActionButtons.prototype.disableButton=function(a){null!=a&&(a.up.visible=!0,a.active.visible=!1)},JustTextPopup=function(a,b,c,d){Phaser.Group.call(this,a,d),this.dialogEngine=c,this.maingame=b,this.textMain=this.game.make.bitmapText(0,0,"badabb","Text goes here.",25),this.textMain.tint=65535,this.add(this.textMain),this.x=-1e3,this.dialogData},JustTextPopup.prototype=Object.create(Phaser.Group.prototype),JustTextPopup.constructor=JustTextPopup,JustTextPopup.prototype.showText=function(a){this.x=0,this.textMain.text=a,this.dialogData=null,this.game.input.onDown.add(this.nextPopup,this)},JustTextPopup.prototype.showTextFromHandler=function(a){this.dialogData=this.dialogEngine.startConvo(a),this.dialogData&&(this.visible=!0,this.x=0,this.textMain.text=this.dialogData.current.DialogueText,this.game.input.onDown.add(this.nextPopup,this))},JustTextPopup.prototype.nextPopup=function(){return this.dialogData&&(this.dialogData=this.dialogEngine.getNextDialog(this.dialogData.current)),null==this.dialogData?void this.closePopup():void(this.textMain.text=this.dialogData.current.DialogueText)},JustTextPopup.prototype.closePopup=function(){this.dialogData=null,this.x=-1e3,this.game.input.onDown.remove(this.nextPopup,this),this.maingame.unpauseGame()},BarkTextHandler=function(){},BarkTextHandler.prototype.barkOverActor=function(){},BarkTextHandler.prototype.barkOverActor=function(){},BarkTextHandler.prototype.returnBarkToPool=function(){},BarkTextHandler.prototype.cleanupAllBarks=function(){},BarkText=function(){this.textfield,this.timer,this.over},BarkText.prototype=function(){};var EventConv=function(){};EventConv.prototype.removeSelf=function(){},EventConv.prototype.activateEvent=function(){this.maingame.showDialog(this.convid),this.once};var EventnText=function(){},HexHandler=function(a,b){this.maingame=a,this.game=b,this.debug=!0,this.visited=[],this.fringes=[]};HexHandler.prototype.lineTest=function(a,b){var c=new Point(a.tileImage.x+this.maingame.halfHex,a.tileImage.y+this.maingame.halfHex),d=new Point(b.tileImage.x+this.maingame.halfHex,b.tileImage.y+this.maingame.halfHex),e=this.game.math.distance(c.x,c.y,d.x,d.y);e=this.game.math.ceil(e/this.maingame.hexagonWidth)+1;for(var f=[],g=0;e>=g;g++){var h=0==e?0:g/e;f.push(this.lerp_point(c,d,h))}for(var i=0;i<f.length;i++){var j=this.maingame.checkHex(f[i].x,f[i].y);if(null==j)return null;if(!j.walkable)return j}return b},HexHandler.prototype.dolines=function(a,b,c){var d=new Point(a.tileImage.x+this.maingame.halfHex,a.tileImage.y+this.maingame.halfHex),e=new Point(b.tileImage.x+this.maingame.halfHex,b.tileImage.y+this.maingame.halfHex);this.debug&&(this.maingame.graphics.clear(),this.maingame.graphics.lineStyle(10,16767232,1),this.maingame.graphics.moveTo(a.tileImage.x+hexagonGroup.x+this.maingame.halfHex,a.tileImage.y+hexagonGroup.y+this.maingame.halfHex),this.maingame.graphics.lineTo(b.tileImage.x+hexagonGroup.x+this.maingame.halfHex,b.tileImage.y+hexagonGroup.y+this.maingame.halfHex));var f=this.game.math.distance(d.x,d.y,e.x,e.y);f=this.game.math.ceil(f/this.maingame.hexagonWidth)+1;for(var g=[],h=0;f>=h;h++){var i=0==f?0:h/f;g.push(this.lerp_point(d,e,i))}var j=[];this.debug&&(this.maingame.graphics.lineStyle(0),this.maingame.graphics.beginFill(65291,.5));for(var k=0;k<g.length;k++){var l=this.maingame.checkHex(g[k].x,g[k].y);if(this.debug&&this.maingame.graphics.drawCircle(g[k].x+hexagonGroup.x,g[k].y+hexagonGroup.y,10),null!=l){if(!l.walkable&&!c)break;j.push(l),this.debug&&this.maingame.highlightpath(k,l)}}if(this.debug&&this.maingame.graphics.endFill(),this.debug)for(k=j.length;k<this.maingame.neighborLights.length;k++)this.maingame.highlightpath(k,null);return j},HexHandler.prototype.round_point=function(a){return new Point(Math.round(a.x),Math.round(a.y))},HexHandler.prototype.lerp=function(a,b,c){return a+c*(b-a)},HexHandler.prototype.lerp_point=function(a,b,c){return new Point(this.lerp(a.x,b.x,c),this.lerp(a.y,b.y,c))},HexHandler.prototype.doFloodFill=function(a,b){this.visited=[],this.visited.push(a),this.fringes=[],this.fringes.push([a]);for(var c=1;b>=c;c++){this.fringes.push([]);for(var d=0;d<this.fringes[c-1].length;d++){var e=this.fringes[c-1][d];e.posx%2==1?(this.addNeighbor(e,0,-1,c),this.addNeighbor(e,-1,0,c),this.addNeighbor(e,0,1,c),this.addNeighbor(e,1,1,c),this.addNeighbor(e,1,0,c),this.addNeighbor(e,-1,1,c)):(this.addNeighbor(e,-1,-1,c),this.addNeighbor(e,-1,0,c),this.addNeighbor(e,0,1,c),this.addNeighbor(e,1,0,c),this.addNeighbor(e,0,-1,c),this.addNeighbor(e,1,-1,c))}}return this.fringes},HexHandler.prototype.addNeighbor=function(a,b,c,d){b=a.posx+b,c=a.posy+c;var e=this.maingame.getTileByCords(b,c);null!=e&&e.walkable&&-1==this.visited.indexOf(e)&&(this.visited.push(e),this.fringes[d].push(e))},HexHandler.prototype.getFrigesAsArray=function(){for(var a=[],b=0;b<fridges.length;b++)for(var c=0;c<fridges[b].length;c++)a.push(fridges[b][c]);return a},HexHandler.prototype.areTilesNeighbors=function(a,b){var c=a.posx-b.posx,d=a.posy-b.posy;if(a.posx%2==1){if(0==c&&-1==d)return!0;if(0==c&&-1==d)return!0;if(-1==c&&0==d)return!0;if(0==c&&1==d)return!0;if(1==c&&1==d)return!0;if(1==c&&0==d)return!0;if(-1==c&&1==d)return!0}else{if(-1==c&&-1==d)return!0;if(-1==c&&0==d)return!0;if(0==c&&1==d)return!0;if(1==c&&0==d)return!0;if(0==c&&-1==d)return!0;if(1==c&&-1==d)return!0}return!1};var MovingCharacter=function(a,b){this.maingame=a,this.name=b,this.sprite=this.maingame.make.sprite(0,0,"actors","movingPerson2_idle0001.png"),this.sprite.anchor.x=.5,this.sprite.anchor.y=1,this.sprite.animations.add("idle",Phaser.Animation.generateFrameNames("movingPerson2_idle",1,2,".png",4),1,!0,!1),this.sprite.animations.add("walk",Phaser.Animation.generateFrameNames("movingPerson2_walk",1,4,".png",4),8,!0,!1),this.sprite.animations.play("idle"),this.oldTile,this.currentTile,this.path=null,this.pathlocation=0,this.nextTile,this.dir=new Phaser.Point,this.walkspeed=.1875,this.inventory=[]};MovingCharacter.prototype.isMoving=function(){return 0==this.dir.x&&0==this.dir.y?!1:!0},MovingCharacter.prototype.setLocation=function(a,b){this.sprite.x=a,this.sprite.y=b},MovingCharacter.prototype.setLocationByTile=function(a){this.sprite.x=a.tileImage.x+this.maingame.halfHex,this.sprite.y=a.tileImage.y+this.maingame.halfHex,this.oldTile=a,this.currentTile=a},MovingCharacter.prototype.setDirection=function(){this.dir.x=this.nextTile.tileImage.x+this.maingame.halfHex-this.sprite.x,this.dir.y=this.nextTile.tileImage.y+this.maingame.halfHex-this.sprite.y,this.dir.normalize()},MovingCharacter.prototype.setPath=function(a){a&&(a.length<=0||(this.path=a,this.pathlocation=0,this.nextTile=this.maingame.getTileByCords(a[this.pathlocation].x,a[this.pathlocation].y),this.setDirection(),this.sprite.animations.play("walk")))},MovingCharacter.prototype.step=function(a){if(null!=this.path&&this.path.length>0&&(this.currentTile=this.maingame.checkHex(this.sprite.x,this.sprite.y),this.currentTile.posx==this.nextTile.posx&&this.currentTile.posy==this.nextTile.posy))if(this.pathlocation++,this.pathlocation>=this.path.length){this.pathlocation=this.path.length;var b=this.currentTile.tileImage.x+this.maingame.halfHex,c=this.currentTile.tileImage.y+this.maingame.halfHex,d=3;b-d<this.sprite.x&&b+d>this.sprite.x&&c-d<this.sprite.y&&c+d>this.sprite.y&&(this.sprite.x=b,this.sprite.y=c,this.path=null,this.dir.x=0,this.dir.y=0,this.currentTile.enterTile(),this.sprite.animations.play("idle")),this.setDirection()}else this.nextTile=this.maingame.getTileByCords(this.path[this.pathlocation].x,this.path[this.pathlocation].y),this.setDirection();this.sprite.x+=this.dir.x*this.walkspeed*a,this.sprite.y+=this.dir.y*this.walkspeed*a,this.dir.x<0?this.sprite.scale.x=-1:this.dir.x>0&&(this.sprite.scale.x=1)};var InteractiveObject=function(a,b){this.maingame=a,this.game=a.game,this.jsondata=b,this.tileobject,this.actions=[];for(var c=this.jsondata.actions,d=0;d<c.length;d++)"actionconvtrigger"==c[d].type?this.handleActionConvTrigger(c[d]):"actorset"==c[d].type?this.handleActorSet(c[d]):"actiontext"==c[d].type&&this.handleActionText(c[d]);this.setupArt(this.jsondata)};InteractiveObject.prototype.handleActorSet=function(){},InteractiveObject.prototype.handleActionConvTrigger=function(a){var b=a;this.actions[a.trigger]=b},InteractiveObject.prototype.handleActionText=function(){},InteractiveObject.prototype.step=function(){},InteractiveObject.prototype.setupReactToAction=function(){this.tileobject.events.onInputDown.add(handleClick,this)},InteractiveObject.prototype.handleClick=function(){},InteractiveObject.prototype.setupArt=function(){var a=this.maingame.getTile(this.jsondata.name,this.jsondata.tilesetid),b=this.jsondata.x,c=this.maingame.gridSizeY-this.jsondata.y-1;this.tileobject=this.game.make.sprite(this.jsondata.offsetx*this.maingame.hexagonWidth,this.jsondata.offsety*this.maingame.hexagonHeight,a.spritesheet,a.tile+".png"),this.maingame.hexagonArray[c][b].tileImage.addChild(this.tileobject),this.tileobject.anchor.x=.5,this.tileobject.anchor.y=1};var InventoryEngine=function(){};InventoryEngine.prototype.enterInventory=function(){};